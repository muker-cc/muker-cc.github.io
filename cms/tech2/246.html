<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class=""> <!--<![endif]-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="renderer" content="webkit">
    <title>彻底掌握分布式事务2PC、3PC模型 - 技术改变生活</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
<meta name="referrer" content="never">
    <link rel="shortcut icon" href="../../assets/img/favicon.jpg" type="image/x-icon">
    <link rel="stylesheet" media="screen" href="../../assets/css/bootstrap.min.css">
    <link rel="stylesheet" media="screen" href="../../assets/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" media="screen" href="../../assets/libs/fastadmin-layer/dist/theme/default/layer.css">
    <link rel="stylesheet" media="screen" href="../../assets/addons/cms/css/swiper.min.css">
    <link rel="stylesheet" media="screen" href="../../assets/addons/cms/css/share.min.css">
    <link rel="stylesheet" media="screen" href="../../assets/addons/cms/css/iconfont.css">
    <link rel="stylesheet" media="screen" href="../../assets/addons/cms/css/common.css">

    <!--[if lt IE 9]>
    <script src="/libs/html5shiv.js"></script>
    <script src="/libs/respond.min.js"></script>
    <![endif]-->

</head>
<body class="group-page">

<header class="header">
    <!-- S 导航 -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html"><img src="../../uploads/20210611/12b922043e5247eeca1b833a969486c3.png" height="40" alt=""></a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav" data-current="34">
                    <!--如果你需要自定义NAV,可使用channellist标签来完成,这里只设置了2级,如果显示无限级,请使用cms:nav标签-->
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../../index.html">首页</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../../cms2.html">新闻动态</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="javascript:window.open('https://www.clrs.me/');">博客</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../special/hmtech.html">鸿蒙专题</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="../product.html" data-toggle="dropdown">产品中心 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../p/reload.html">充值缴费</a></li>
                                                        <li><a href="../weixingongju.html">微信工具</a></li>
                                                        <li><a href="../dianshangxitong.html">电商系统</a></li>
                                                        <li><a href="../zaixianjiaoyu.html">在线教育</a></li>
                                                        <li><a href="../quanziluntan.html">圈子论坛</a></li>
                                                        <li><a href="../neirongguanliCMS.html">内容管理(CMS)</a></li>
                                                        <li><a href="../yumingchushou.html">域名出售</a></li>
                                                        <li><a href="../opensource.html">开源项目</a></li>
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown">解决方案 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../qiyejiejuefangan.html">企业解决方案</a></li>
                                                        <li><a href="../p/tongyongjiejuefangan.html">通用解决方案</a></li>
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="../download.html" data-toggle="dropdown">下载中心 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../fuwuqi.html">服务器</a></li>
                                                        <li><a href="../caozuoxitong.html">操作系统</a></li>
                                                    </ul>
                    </li>
                    
                    <!--如果需要无限级请使用cms:nav标签-->
                    
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <form class="form-inline navbar-form" action="/cms/s.html" method="get">
                            <div class="form-search hidden-sm hidden-md">
                                <input class="form-control" name="q" data-suggestion-url="/addons/cms/search/suggestion.html" type="text" id="searchinput" value="" placeholder="搜索">
                            </div>
                            <input type="hidden" name="__searchtoken__" value="5d9457608a8c03a8c5cd085b9e2b47dc">                        </form>
                    </li>
                    <li class="dropdown">
                                                <a href="../../index/user/index.html" class="dropdown-toggle" data-toggle="dropdown">会员<span class="hidden-sm">中心</span> <b class="caret"></b></a>
                                                <ul class="dropdown-menu">
                                                        <li><a href="../../index/user/login1.html"><i class="fa fa-sign-in fa-fw"></i> 登录</a></li>
                            <li><a href="../../index/user/register.html"><i class="fa fa-user-o fa-fw"></i> 注册</a></li>
                                                    </ul>
                    </li>
                </ul>
            </div>

        </div>
    </nav>
    <!-- E 导航 -->

</header>

<main class="main-content">
    

<div class="container" id="content-container">

    <div class="row">

        <main class="col-md-8">
            <div class="panel panel-default article-content">
                <div class="panel-heading">
                    <ol class="breadcrumb">
                        <!-- S 面包屑导航 -->
                                                <li><a href="../index.html">首页</a></li>
                                                <li><a href="../tech2.html">技术</a></li>
                                                <!-- E 面包屑导航 -->
                    </ol>
                </div>
                <div class="panel-body">
                    <div class="article-metas">
                        <h1 class="metas-title">彻底掌握分布式事务2PC、3PC模型</h1>

                        <div class="metas-body">
                                                        <span class="views-num">
                                <i class="fa fa-eye"></i> 120 阅读
                            </span>
                            <span class="comment-num">
                                <i class="fa fa-comments"></i> 0 评论
                            </span>
                            <span class="like-num">
                                <i class="fa fa-thumbs-o-up"></i>
                                <span class="js-like-num"> 0 点赞
                                </span>
                            </span>
                        </div>
                        
                    </div>

                    <div class="article-text">
                        <!-- S 正文 -->
                        <p>
                                                        <div class="rich_media_content " id="js_content" style="visibility: visible;">                                                                                                    <section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;" data-mpa-powered-by="yiban.io"><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><span style="letter-spacing: 0px;">工作中使</span><span style="letter-spacing: 0px;">用最多的是本地事务，但是在对单一项目拆分为 SOA、微服务之后，就会牵扯出分布式事务场景</span><br></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">文章以分布式事务为主线展开说明，并且针对 2PC、3PC 算法进行详细的讲解，最后通过一个 Demo 来更深入掌握分布式事务，文章目录结构如下</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;border-left-color: rgba(0, 0, 0, 0.4);background: rgba(0, 0, 0, 0.05);color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;"><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">什么是事务</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">什么是分布式事务</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">DTP 模型和 XA 规范</section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">什么是 DTP 模型</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">什么是 XA 规范</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">2PC 一致性算法</section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">2PC-准备阶段</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">2PC-提交阶段</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">2PC 算法优缺点</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">3PC 一致性算法</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">JDBC 操作 MySQL XA 事务</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">结言</section></li></ul></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>什么是事务</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">事务是<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">数据库操作的最小工作单元</code>，一组不可再分割的操作集合，是作为单个逻辑工作单元执行的一系列操作。这些操作作为一个整体一起向系统提交，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">要么都执行、要么都不执行</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">事务具有四个特征，分别是<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability）</code>，简称为事务的 ACID 特性</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>如何保证事务的 ACID 特性？</strong></p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">原子性（Atomicity）：事务内 SQL 要么同时成功要么同时失败，基于撤销日志（undo 日志）实现</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">一致性（Consistency）：系统从一个正确态转移到另一个正确态，由应用通过 AID 来保证，可以说是事务的核心特性</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">隔离性（Isolation）：控制事务并发执行时数据的可见性，基于锁和多版本并发控制（mvcc）实现</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">持久性（Durability）：提交后一定存储成功不会丢失，基于重做日志（redo log）实现</p></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">文章主要是介绍分布式事务 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">2PC 和 3PC</code>，关于 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">redo、undo 日志、mvcc、锁</code>这块的内容后续再详细介绍</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在早些时候，我们应用程序还是单体项目，所以操作的都是单一数据库，这种情况下我们称之为<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">本地事务</code>。本地事务的 ACID 一般都是由数据库层面支持的，比如我们工作中常用的 MySQL 数据库</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.5095846645367412" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="626" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 157.933px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">平常我们在操作 MySQL 客户端时，MySQL 会隐式对事务做自动提交，所以日常工作不会涉及手动书写事务的创建、提交、回滚等操作。如果想要试验锁、MVCC等特性，可以创建多个会话，通过<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">begin、commit、rollback</code>等命令来试验下不同事务之间的数据，看执行结果和自己所想是否一致</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.4143356643356643" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="572" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 128.787px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们平常开发项目代码时使用的是 Spring 封装好的事务，所以也不会手动编写对数据库事务的提交、回滚等方法（个别情况除外）。这里使用原生 JDBC 写一个示例代码，帮助大家理解如何通过事务保证 ACID 四大特性</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;background: #282c34;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Connection&nbsp;conn&nbsp;=&nbsp;...;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;获取数据库连接</span><br>conn.setAutoCommit(<span style="color: #c678dd;line-height: 26px;">false</span>);&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;开启事务</span><br><span style="color: #c678dd;line-height: 26px;">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;...执行增删改查sql</span><br>&nbsp;&nbsp;&nbsp;conn.commit();&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;提交事务</span><br>}&nbsp;<span style="color: #c678dd;line-height: 26px;">catch</span>&nbsp;(Exception&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;conn.rollback();&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;事务回滚</span><br>}&nbsp;<span style="color: #c678dd;line-height: 26px;">finally</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;conn.close();&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;关闭链接</span><br>}<br></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">设想一下，每次进行数据库操作，都要写重复的创建事务、提交、回滚等方法是不是挺痛苦的，那 Spring 如何自动帮助我们管理事务的呢？Spring 项目中我们一般使用两种方式来进行事务的管理，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">编程式事务和声明式事务</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">项目中使用 Spring 管理事务，要么在接口方法上添加注解 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">@Transactional</code>，要么使用 AOP 配置切面事务。其实这两种方式大同小异，只不过 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">@Transactional</code> 的粒度更细一些，实现原理上都是依赖 AOP，举例说明下</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;background: #282c34;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #61aeee;line-height: 26px;">@Service</span><br><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">class</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">TransactionalService</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span style="color: #61aeee;line-height: 26px;">@Transactional</span><br>&nbsp;&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">void</span>&nbsp;<span style="color: #61aeee;line-height: 26px;">save</span><span style="line-height: 26px;">()</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;业务操作</span><br>&nbsp;&nbsp;}<br>}<br></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">TransactionalService</code> 会被 Spring 创建一个代理对象放入到容器中，创建后的代理对象相当于下述类</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;background: #282c34;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">class</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">TransactionalServiceProxy</span>&nbsp;</span>{<br>&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">private</span>&nbsp;TransactionalService&nbsp;transactionalService;<br>&nbsp;&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="color: #61aeee;line-height: 26px;">TransactionalServiceProxy</span><span style="line-height: 26px;">(TransactionalService&nbsp;transactionalService)</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">this</span>.transactionalService&nbsp;=&nbsp;transactionalService;<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">void</span>&nbsp;<span style="color: #61aeee;line-height: 26px;">save</span><span style="line-height: 26px;">()</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;开启事务操作</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transactionalService.save();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">catch</span>&nbsp;(Exception&nbsp;e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;出现异常则进行回滚</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;提交事务</span><br>&nbsp;&nbsp;}<br>}<br></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">示例代码看着简洁明了，但是真正的代码生成代码对比要复杂很多。关于事务管理器，Spring 提供了接口 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">PlatformTransactionManager</code>，其内部包含两个重要实现类</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">DataSourceTransactionManager</code>：支持本地事务，内部通过<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">java.sql.Connection</code>来开启、提交和回滚事务</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">JtaTransactionManager</code>：用于支持分布式事务，其实现了 JTA 规范，使用 XA 协议进行两阶段提交</p></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">通过这两个实现类得知，平常我们使用的<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">编程式事务和声明式事务</code>依赖于本地事务管理实现，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Spring 同时也支持分布式事务</code>，关于 JTA 分布式事务的支持网上资料挺多的，就不在这里赘述了</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>什么是分布式事务</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">日常业务代码中的本地事务我们一直都在用，理解起来并不困难。但是随着<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">服务化（SOA）、微服务</code>的流行，平常我们的单一业务系统被拆分成为了多个系统，为了迎合业务系统的变更，数据库也结合业务进行了拆分</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">比如以学校管理系统举例说明，可能就会拆分为学生服务、课程服务、老师服务等，数据库也拆分为多个库。当这种情况，把不同的服务部署到服务器，就会有可能面临下述的服务调用</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.6209850107066381" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="934" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 192.021px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">ServiceA 服务需要操作数据库执行本地事务，同时需要调用 ServiceB 和 ServiceC 服务发起事务调用，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">如何保证三个服务的事务要么一起成功或者一起失败</code>，如何保证用户发起请求的事务 ACID 特性呢？无疑这就是分布式事务场景，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">三个服务的单一本地事务都无法保证整个请求的事务</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">分布式事务场景有很多种解决方案，以不同分类来看，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">强一致性解决方案、最终一致性解决方案</code>，细分其中的方案包括<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">2PC、3PC、TCC、可靠消息...</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">业界中使用较多的像阿里的 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">RocketMQ 事务消息</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">Seata XA模式</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">可靠消息模型</code>这几种解决方案。不过，分布式事务无一例外都是会直接或间接操作多个数据库，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">而且使用了分布式事务同时也会带来新的挑战，那就是性能问题</code>。如果为了保证强一致性分布式事务亦或者补偿方案的最终一致性，导致了性能的下降，对于正常业务而言，无疑是得不偿失的</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>DTP 模型和 XA 规范</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">X/Open 组织定义了分布式事务的模型（DTP）和 分布式事务协议（XA），DTP 由以下几个模型元素组成</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">AP（Application 应用程序）</code>：用于定义事务边界(即定义事务的开始和结束)，并且在事务边界内对资源进行操作</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">TM（Transaction Manager 事务管理器）</code>：负责分配事务唯一标识，监控事务的执行进度，并负责事务的提交、回滚等</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">RM（Resource Manager 资源管理器）</code>：如数据库、文件系统等，并提供访问资源的方式</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">CRM（Communication Resource Manager 通信资源管理器）：控制一个TM域(TM domain)内或者跨TM域的分布式应用之间的通信</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">CP（Communication Protocol 通信协议）：提供CRM提供的分布式应用节点之间的底层通信服务</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在 DTP 分布式事务模型中，基本组成需要涵盖 <strong>AP、TM、RMS</strong>（不需要 CRM、CP 也是可以的），如下图所示</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.5327272727272727" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="1100" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 165.015px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>XA 规范<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">XA 规范最重要的作用就是定义 RM（资源管理器）与 TM（事务管理器）之间的交互接口。另外，XA 规范除了定义 2PC 之间的交互接口外，同时对 2PC 进行了优化</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.532608695652174" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="1104" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 164.978px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong><span style="color:#FF0000;">梳理下 DTP、XA、2PC 之间的关系</span></strong></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">DTP 规定了分布式事务中的角色模型</code>，并在其中指定了全局事务的控制需要使用 2PC 协议来保证数据的一致性</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">2PC 是 Two-Phase Commit 的缩写，即二阶段提交，是计算机网络尤其是数据库领域内，为了保证分布式系统架构下所有节点在进行事务处理过程中能够<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">保证原子性和一致性</code>而设计的一种算法。同时，2PC 也被认为是一种一致性协议，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">用来保证分布式系统数据的一致性</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">XA 规范是 X/Open 组织提出的分布式事务处理规范，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">XA 规范定义了 2PC（两阶段提交协议）中需要用到的接口</code>，也就是上图中 RM 和 TM 之间的交互。2PC 和 XA 两者最容易混淆，可以这么理解，DTP 模型定义 TM 和 RM 之间通讯的接口规范叫 XA，然后 <strong>关系数据库（比如MySQL）基于 X/Open 提出的的 XA&nbsp;规范（核心依赖于 2PC 算法）被称为 XA 方案</strong></p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>2PC 一致性算法</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当应用程序（AP）发起一个事务操作需要<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">跨越多个分布式节点</code>的时候，每一个<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">分布式节点（RM）</code>知道自己进行事务操作的结果是成功或是失败，但是却<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">不能获取到其它分布式节点的操作结果</code>。为了保证事务处理的 ACID 特性，就需要引入称为<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">"协调者"的组件（TM）</code>来进行统一调度分布式的执行逻辑</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">协调者负责调度参与整体事务的分布式节点的行为</code>，并最终决定这些分布式节点要把事务进行提交还是回滚。所以，基于这种思想下，衍生出了<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">二阶段提交和三阶段提交</code>两种分布式一致性算法协议。二阶段指的是<strong>准备阶段和提交阶段</strong>，下面我们先看准备阶段都做了什么事情</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2PC-准备阶段<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">二阶段提交中第一阶段也叫做<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">"投票阶段"</code>，即各参与者投票表明自身是否继续执行接下来的事务提交步骤</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>事务询问</strong>：协调者向所有参与本次分布式事务的参与者发送事务内容，询问是否可以执行事务提交操作，然后开始等待各个参与者的响应</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>执行事务</strong>：参与者收到协调者的事务请求，执行对应的事务，并将内容写入 Undo 和 Redo 日志</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>返回响应</strong>：如果各个参与者执行了事务，那么反馈协调者 Yes 响应；如果各个参与者没有能够成功执行事务，那么就会返回协调者 No 响应</p></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果第一阶段全部参与者返回成功响应，那么进入事务提交步骤，反之本次分布式事务以失败返回。以 MySQL 数据库为例，在第一阶段，事务管理器（TM）向所有涉及到的数据库（RM）发出 <strong>prepare（准备提交）</strong> 请求，数据库收到请求后执行数据修改和日志记录处理，处理完成后把事务的状态修改为 "可提交"，最终将结果返回给事务处理器</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2PC-提交阶段<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">提交阶段分为两个流程，一个是各参与者正常执行事务提交流程，并返回 Yes 响应，表示各参与者投票执行成功；一个是各参与者当中有执行失败返回 No 响应或超时情况，将触发全局回滚，表示分布式事务执行失败</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">执行事务提交</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">中断事务</p></section></li></ul><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>执行事务提交<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">假设协调者从所有的参与者获得的反馈都是 Yes 响应，那么就会执行事务提交操作</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">事务提交：协调者向所有参与者节点发出 Commit 请求，各个参与者接收到 Commit 请求后，将本地事务进行提交操作，并在完成提交之后释放事务执行周期内占用的事务资源</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">完成事务：各个参与者完成事务提交之后，向协调者发送 Ack 响应，协调者接收到响应后完成本次分布式事务</p></section></li></ul><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.3969298245614035" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="1824" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 123.461px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>中断事务<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">假设任意一个事务参与者节点向协调者反馈了 No 响应（<strong><span style="color:#FF0000;">注意这里的 No 响应指的是第一阶段</span></strong>），或者在等待超时之后，协调者没有接到所有参与者的反馈响应，那么就会进行事务中断流程</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">事务回滚：协调者向所有参与者发出 Rollback 请求，参与者接收到回滚请求后，使用第一阶段写入的 undo log 执行事务的回滚，并在完成回滚事务之后释放占用的资源</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">中断事务：参与者在完成事务回滚之后，向协调者发送 Ack 消息，协调者接收到事务参与者的 Ack 消息之后，完成事务中断</p></section></li></ul><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.433589462129528" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="1822" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 134.678px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2PC 优缺点<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">2PC 提交将事务的处理过程分为了投票和执行两个阶段，核心思想就是对每个事务都采用先尝试后提交的方式处理。2PC 优点显而易见，那就是 <strong>原理简单，实现方便</strong>。简单也意味着很多地方不能尽善尽美，这里梳理三个比较核心的缺陷</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">同步阻塞：无论是在第一阶段的过程中，还是在第二阶段，所有的<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">参与者资源和协调者资源都是被锁住的</code>，只有当所有节点准备完毕，事务协调者才会通知进行全局提交，参与者进行本地事务提交后才会释放资源。<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">这样的过程会比较漫长，对性能影响比较大</code></p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">单点故障：<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">如果协调者出现问题，那么整个二阶段提交流程将无法运转</code>。另外，如果协调者是在第二阶段出现了故障，那么其它参与者将会处于锁定事务资源的状态中</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">数据不一致性：当协调者在第二阶段向所有参与者发送 Commit 请求后，发生了<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">局部网络异常或者协调者在尚未发送完 Commit 请求之前自身发生了崩溃</code>，导致只有部分参与者接收到 Commit 请求，那么<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">接收到的参与者就会进行提交事务</code>，进而形成了数据不一致性</p></section></li></ol><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">由于 2PC 的简单方便，所以会产生上述的同步阻塞、单点故障、数据不一致等情况，所以在 2PC 的基础上做了改进，推行出了三阶段提交（3PC）</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;border-left-color: rgba(0, 0, 0, 0.4);background: rgba(0, 0, 0, 0.05);color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">使用 2PC 存在诸多限制，首先就是数据库需要支持 XA 规范，而且性能与数据一致性数据均不友好，所以 Seata 中虽然支持 XA 模式，但是主推的还是 AT 模式</p></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>3PC 一致性算法</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">三阶段提交（3PC）是二阶段提交（2PC）的一个改良版本，引入了两个新的特性</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">协调者和参与者均引入超时机制</code>，通过超时机制来解决 2PC 的同步阻塞问题，避免事务资源被永久锁定</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">把二阶段演变为三阶段，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">二阶段提交协议中的第一阶段"准备阶段"一分为二</code>，形成了新的 CanCommit、PreCommit、do Commit 三个阶段组成事务处理协议</p></section></li></ol><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.5253682487725041" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="611" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 162.763px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这里将不再赘述 3PC 的详细提交过程，3PC 相比较于 2PC 最大的优点就是<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">降低了参与者的阻塞范围</code>，并且能够在协调者出现单点故障后继续达成一致</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">虽然通过超时机制解决了资源永久阻塞的问题，但是 3PC 依然存在数据不一致的问题。<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">当参与者接收到 PreCommit 消息后</code>，如果网络出现分区，此时协调者与参与者无法进行正常通信，这种情况下，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">参与者依然会进行事务的提交</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">通过了解 2PC 和 3PC 之后，我们可以知道这两者都无法彻底解决分布式下的数据一致性</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>JDBC 操作 MySQL XA 事务</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">MySQL 从 5.0.3 开始支持 XA 分布式事务，且只有 InnoDB 存储引擎支持。MySQL Connector/J 从5.0.0 版本之后开始直接提供对 XA 的支持</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.48074534161490684" data-src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" data-type="png" data-w="1610" style="display: block; margin-right: auto; margin-left: auto; width: 308px !important; height: 149.108px !important;" _width="328px" class="img_loading" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" crossorigin="anonymous" alt="图片"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在 DTP 模型中，MySQL 属于 RM 资源管理器，所以这里就不再演示 MySQL 支持 XA 事务的语句，因为它执行的只是自己单一事务分支，我们通过 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;">JDBC 来演示如何通过 TM 来控制多个 RM 完成 2PC 分布式事务</code></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这里先来说明需要引入 GAV 的 Maven 版本，因为高版本 8.x 移除了对 XA 分布式事务的支持（<em>可能也是觉得没人会用吧</em>）</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;background: #282c34;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="line-height: 26px;">&lt;<span style="color: #e06c75;line-height: 26px;">dependencies</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">&lt;!--&nbsp;https://mvnrepository.com/artifact/mysql/mysql-connector-java&nbsp;--&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;">&lt;<span style="color: #e06c75;line-height: 26px;">dependency</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;">&lt;<span style="color: #e06c75;line-height: 26px;">groupId</span>&gt;</span>mysql<span style="line-height: 26px;">&lt;/<span style="color: #e06c75;line-height: 26px;">groupId</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;">&lt;<span style="color: #e06c75;line-height: 26px;">artifactId</span>&gt;</span>mysql-connector-java<span style="line-height: 26px;">&lt;/<span style="color: #e06c75;line-height: 26px;">artifactId</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;">&lt;<span style="color: #e06c75;line-height: 26px;">version</span>&gt;</span>5.1.38<span style="line-height: 26px;">&lt;/<span style="color: #e06c75;line-height: 26px;">version</span>&gt;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;">&lt;/<span style="color: #e06c75;line-height: 26px;">dependency</span>&gt;</span><br><span style="line-height: 26px;">&lt;/<span style="color: #e06c75;line-height: 26px;">dependencies</span>&gt;</span><br></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这里为了保证在公众号阅读的舒适性，通过 IDEA 将多行代码合并为一行了，如果小伙伴需要粘贴到 IDEA 中，格式化一下就好了</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">因为 XA 协议的基础是 2PC 一致性算法，所以小伙伴在看代码时可以对照上面文章讲的 DTP 模型和 2PC 来进行理解以及模拟错误和执行结果</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;background: #282c34;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;com.mysql.jdbc.jdbc2.optional.MysqlXAConnection;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;com.mysql.jdbc.jdbc2.optional.MysqlXid;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;javax.sql.XAConnection;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;javax.transaction.xa.XAException;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;javax.transaction.xa.XAResource;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;javax.transaction.xa.Xid;<span style="color: #c678dd;line-height: 26px;">import</span>&nbsp;java.sql.*;<br><br><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">class</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">MysqlXAConnectionTest</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;"><span style="color: #c678dd;line-height: 26px;">public</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">static</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">void</span>&nbsp;<span style="color: #61aeee;line-height: 26px;">main</span><span style="line-height: 26px;">(String[]&nbsp;args)</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">throws</span>&nbsp;SQLException&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;true&nbsp;表示打印&nbsp;XA&nbsp;语句,&nbsp;用于调试</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">boolean</span>&nbsp;logXaCommands&nbsp;=&nbsp;<span style="color: #c678dd;line-height: 26px;">true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;获得资源管理器操作接口实例&nbsp;RM1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connection&nbsp;conn1&nbsp;=&nbsp;DriverManager.getConnection(<span style="color: #98c379;line-height: 26px;">"jdbc:mysql://localhost:3306/test"</span>,&nbsp;<span style="color: #98c379;line-height: 26px;">"root"</span>,&nbsp;<span style="color: #98c379;line-height: 26px;">"root"</span>);XAConnection&nbsp;xaConn1&nbsp;=&nbsp;<span style="color: #c678dd;line-height: 26px;">new</span>&nbsp;MysqlXAConnection((com.mysql.jdbc.Connection)&nbsp;conn1,&nbsp;logXaCommands);XAResource&nbsp;rm1&nbsp;=&nbsp;xaConn1.getXAResource();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;获得资源管理器操作接口实例&nbsp;RM2</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connection&nbsp;conn2&nbsp;=&nbsp;DriverManager.getConnection(<span style="color: #98c379;line-height: 26px;">"jdbc:mysql://localhost:3306/test"</span>,&nbsp;<span style="color: #98c379;line-height: 26px;">"root"</span>,&nbsp;<span style="color: #98c379;line-height: 26px;">"root"</span>);XAConnection&nbsp;xaConn2&nbsp;=&nbsp;<span style="color: #c678dd;line-height: 26px;">new</span>&nbsp;MysqlXAConnection((com.mysql.jdbc.Connection)&nbsp;conn2,&nbsp;logXaCommands);XAResource&nbsp;rm2&nbsp;=&nbsp;xaConn2.getXAResource();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;AP（应用程序）请求&nbsp;TM（事务管理器）&nbsp;执行一个分布式事务,&nbsp;TM&nbsp;生成全局事务&nbsp;ID</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">byte</span>[]&nbsp;gtrid&nbsp;=&nbsp;<span style="color: #98c379;line-height: 26px;">"distributed_transaction_id_1"</span>.getBytes();<span style="color: #c678dd;line-height: 26px;">int</span>&nbsp;formatId&nbsp;=&nbsp;<span style="color: #d19a66;line-height: 26px;">1</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;==============&nbsp;分别执行&nbsp;RM1&nbsp;和&nbsp;RM2&nbsp;上的事务分支&nbsp;====================</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;TM&nbsp;生成&nbsp;RM1&nbsp;上的事务分支&nbsp;ID</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">byte</span>[]&nbsp;bqual1&nbsp;=&nbsp;<span style="color: #98c379;line-height: 26px;">"transaction_001"</span>.getBytes();Xid&nbsp;xid1&nbsp;=&nbsp;<span style="color: #c678dd;line-height: 26px;">new</span>&nbsp;MysqlXid(gtrid,&nbsp;bqual1,&nbsp;formatId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;执行&nbsp;RM1&nbsp;上的事务分支</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm1.start(xid1,&nbsp;XAResource.TMNOFLAGS);PreparedStatement&nbsp;ps1&nbsp;=&nbsp;conn1.prepareStatement(<span style="color: #98c379;line-height: 26px;">"INSERT&nbsp;into&nbsp;user(name)&nbsp;VALUES&nbsp;('jack')"</span>);ps1.execute();rm1.end(xid1,&nbsp;XAResource.TMSUCCESS);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;TM&nbsp;生成&nbsp;RM2&nbsp;上的事务分支&nbsp;ID</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">byte</span>[]&nbsp;bqual2&nbsp;=&nbsp;<span style="color: #98c379;line-height: 26px;">"transaction_002"</span>.getBytes();Xid&nbsp;xid2&nbsp;=&nbsp;<span style="color: #c678dd;line-height: 26px;">new</span>&nbsp;MysqlXid(gtrid,&nbsp;bqual2,&nbsp;formatId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;执行&nbsp;RM2&nbsp;上的事务分支</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm2.start(xid2,&nbsp;XAResource.TMNOFLAGS);PreparedStatement&nbsp;ps2&nbsp;=&nbsp;conn2.prepareStatement(<span style="color: #98c379;line-height: 26px;">"INSERT&nbsp;into&nbsp;user(name)&nbsp;VALUES&nbsp;('rose')"</span>);ps2.execute();rm2.end(xid2,&nbsp;XAResource.TMSUCCESS);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;===================&nbsp;两阶段提交&nbsp;================================</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;phase1:&nbsp;询问所有的RM&nbsp;准备提交事务分支</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">int</span>&nbsp;rm1_prepare&nbsp;=&nbsp;rm1.prepare(xid1);<span style="color: #c678dd;line-height: 26px;">int</span>&nbsp;rm2_prepare&nbsp;=&nbsp;rm2.prepare(xid2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;phase2:&nbsp;提交所有事务分支</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(rm1_prepare&nbsp;==&nbsp;XAResource.XA_OK&nbsp;&amp;&amp;&nbsp;rm2_prepare&nbsp;==&nbsp;XAResource.XA_OK)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;所有事务分支都&nbsp;prepare&nbsp;成功,&nbsp;提交所有事务分支</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm1.commit(xid1,&nbsp;<span style="color: #c678dd;line-height: 26px;">false</span>);rm2.commit(xid2,&nbsp;<span style="color: #c678dd;line-height: 26px;">false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">//&nbsp;如果有事务分支没有成功,&nbsp;则回滚</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm1.rollback(xid1);rm1.rollback(xid2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">catch</span>&nbsp;(XAException&nbsp;e)&nbsp;{&nbsp;e.printStackTrace();&nbsp;}&nbsp;}}<br></code></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;"><span style="display: none;"></span>结言</h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文通过图文并茂的方式讲解了如何保证本地事务的四大特性，分布式事务的产出背景，以及 2PC、3PC 为何不能解决分布式情况下的数据一致性，最后通过 JDBC 演示了 2PC 的执行流程。相信大家看过后也对分布式事务有了较深的印象，同时对 DTP、XA、2PC 这几种比较容易混淆的概念有了清楚的认识</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这是《分布式事务》专栏的第一章开篇，后面陆续完成通过消息中间件、可靠消息模型、Seata XA模型完成分布式事务的文章，并对不同的实现方式进行总结利弊，挑选出合适场景使用不同的分布式事务解决方案</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">作者认为最好的学习方式那就是实战，如果没有接触过分布式事务的小伙伴，可以通过自己正在写的项目，模拟出分布式事务的业务场景，加深印象的同时也能够更好理解分布式事务解决方案相关设计思路</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>创作不易，文章看到这里如果有所帮助，可以点个关注支持一下，祝好。我们下期见</strong></p><br data-tool="mdnice编辑器"><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>站在巨人的肩膀</strong></p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">《从Paxos到Zookeeper分布式一致性原理与实践》</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">《田守枝Java技术博客》</p></section></li></ul><section class=""><mpprofile class="js_uneditable" data-pluginname="mpprofile" data-id="Mzg4NDU0Mjk5OQ==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/vtZYwyYqLc6mE1Sl97Q9HnxI7wE1Kia9MSsuL4CEFSeRFlrGFPlolPMAnPsCxuU7cVd1q0gynHSyn1UibHF63t6Q/0?wx_fmt=png" data-nickname="龙台的技术笔记" data-alias="machencoding" data-signature="高级Java开发工程师，CSDN博客专家，掘金年度人气作者。专注高并发、中间件、分布式、框架底层源码等知识分享" data-from="0"> <!-- profile卡片 --> <div class="appmsg_card_context wx_profile_card js_wx_profile_card" data-id="Mzg4NDU0Mjk5OQ==" data-isban="0" data-index="0">   <div class="wx_profile_card_bd">     <div class="wx_profile weui-flex">       <div class="wx_profile_hd">                  <img class="wx_profile_avatar" src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" alt="龙台的技术笔记">                </div>       <div class="wx_profile_bd weui-flex weui-flex__item">         <div class="weui-flex__item">           <strong class="wx_profile_nickname">                                龙台的技术笔记                           </strong>           <div class="wx_profile_desc">高级Java开发工程师，CSDN博客专家，掘金年度人气作者。专注高并发、中间件、分布式、框架底层源码等知识分享</div>           <div class="wx_profile_tips" id="js_profile_desc">             <span class="wx_profile_tips_meta" id="js_profile_article">69篇原创内容</span>             <!-- <span class="wx_profile_tips_meta" id="js_profile_friends"></span> -->           </div>         </div>         <i class="weui-icon-arrow"></i>       </div>     </div>   </div>   <div class="wx_profile_card_ft">公众号</div> </div> </mpprofile></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><br></p></section>                </div><div>来源:https://mp.weixin.qq.com/s/UUt_TX5tPBFTEDGu87o_mA</div>                        
                        <!-- E 正文 -->
                    </div>

                    <!-- S 付费阅读 -->
<!-- E 付费阅读 -->


                    <!-- S 点赞 -->
<div class="article-donate">
    <a href="javascript:" class="btn btn-primary btn-like btn-lg" data-action="vote" data-type="like" data-id="246" data-tag="archives"><i class="fa fa-thumbs-up"></i> 点赞(<span>0</span>)</a>
    <a href="javascript:" class="btn btn-outline-primary btn-donate btn-lg" data-action="donate" data-id="246" data-image="../../uploads/20210611/c81a0eac1c3e5de3ecee547f7d6afebb.png"><i class="fa fa-cny"></i> 打赏</a>
</div>
<!-- E 点赞 -->


                    

<!-- S 分享 -->
<div class="social-share text-center mt-2 mb-1" data-initialized="true" data-mode="prepend" data-image="https://mmbiz.qpic.cn/mmbiz_png/vtZYwyYqLc6WKk55QWSicKGNhFetCXdWph38L9xfksQCeBUARsbGyys4nqLdkhaciaLs5e6GKs8rrrpeuUSg56ew/640">
    <a href="javascript:;" class="social-share-icon icon-heart addbookbark" data-type="archives" data-aid="246" data-action="/addons/cms/ajax/collection.html"></a>
    <a href="#" class="social-share-icon icon-weibo" target="_blank"></a>
    <a href="#" class="social-share-icon icon-qq" target="_blank"></a>
    <a href="#" class="social-share-icon icon-qzone" target="_blank"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
</div>

<!-- E 分享 -->


                    <div class="entry-meta">
    <ul>
        <!-- S 归档 -->
        <li>本文分类：<a href="../tech2.html">技术</a></li>
        <li>本文标签：<a href="../t/数据库.html" class="tag" rel="tag">数据库</a><a href="../t/netstat.html" class="tag" rel="tag"> 事务</a></li>
        <li>浏览次数：<span>120</span> 次浏览</li>
        <li>发布日期：2021-07-16 09:17:34</li>
        <li>本文链接：<a href="">http://muker.cc/cms/tech2/246.html</a></li>
        <!-- S 归档 -->
    </ul>

    <ul class="article-prevnext">
        <!-- S 上一篇下一篇 -->
                <li>
            <span>上一篇 &gt;</span>
            <a href="243.html">微软评测，大厂标配的Daper，碾压Spring Cloud！</a>
        </li>
                <li>
            <span>下一篇 &gt;</span>
            <a href="247.html">.NET对象池的使用</a>
        </li>
                <!-- E 上一篇下一篇 -->
    </ul>
</div>


                    <div class="related-article">
    <div class="row">
        <!-- S 相关文章 -->
                <div class="col-sm-3 col-xs-6">
            <a href="" class="img-zoom">
                <div class="embed-responsive embed-responsive-4by3">
                    <img src="../../mmbiz_png/mywaEccpTnSauzxqicw6wH2n8A7H5g4iaicdRAibomdYiaT9lTrUU7IktjaQeBOtnI6xyQQPDicUQJuSGCengxeWyzSw/640.jpg" alt="彻底掌握分布式事务2PC、3PC模型" class="embed-responsive-item">
                </div>
            </a>
            <h5 class="text-center"><a href="">彻底掌握分布式事务2PC、3PC模型</a></h5>
        </div>
                <!-- E 相关文章 -->
    </div>
</div>


                    <div class="clearfix"></div>
                </div>
            </div>

            <div class="panel panel-default" id="comments">
                <div class="panel-heading">
                    <h3 class="panel-title">评论列表                        <small>共有 <span>0</span> 条评论</small>
                    </h3>
                </div>
                <div class="panel-body">
                                        <div id="comment-container">
    <!-- S 评论列表 -->
    <div id="commentlist">
                <div class="loadmore loadmore-line loadmore-nodata"><span class="loadmore-tips">暂无评论</span></div>
            </div>
    <!-- E 评论列表 -->

    <!-- S 评论分页 -->
    <div id="commentpager" class="text-center">
            </div>
    <!-- E 评论分页 -->

    <!-- S 发表评论 -->
    <div id="postcomment">
        <h3>发表评论 <a href="javascript:;">
            <small>取消回复</small>
        </a></h3>
        <form action="/addons/cms/comment/post.html" method="post" id="postform">
            <input type="hidden" name="__token__" value="5d9457608a8c03a8c5cd085b9e2b47dc">            <input type="hidden" name="type" value="archives">
            <input type="hidden" name="aid" value="246">
            <input type="hidden" name="pid" id="pid" value="0">
            <div class="form-group">
                <textarea name="content" class="form-control" disabled="" placeholder="请登录后再发表评论" id="commentcontent" cols="6" rows="5" tabindex="4"></textarea>
            </div>
                        <div class="form-group">
                <a href="../../index/user/login1.html" class="btn btn-primary">登录</a>
                <a href="../../index/user/register.html" class="btn btn-outline-primary">注册新账号</a>
            </div>
                    </form>
    </div>
    <!-- E 发表评论 -->
</div>

                                    </div>
            </div>

        </main>

        <aside class="col-xs-12 col-sm-4">
                        <!-- S 关于作者 -->
            <div class="panel panel-default about-author" data-id="2" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <meta itemprop="name" content="clrs">
                <meta itemprop="image" content="../../uploads/20210611/1c33f3b2e46303967d5fa6e70be59f24.png">
                <meta itemprop="url" content="/u/2">
                <div class="panel-heading">
                    <h3 class="panel-title">关于作者</h3>
                </div>
                <div class="panel-body">
                    <div class="media">
                        <div class="media-left">
                            <a href="../../u/2.html">
                                <img class="media-object img-circle img-medium" style="width:64px;height:64px;" src="../../uploads/20210611/1c33f3b2e46303967d5fa6e70be59f24.png" data-holder-rendered="true">
                            </a>
                        </div>
                        <div class="media-body">
                            <h3 style="margin-top:10px;" class="media-heading">
                                <a href="../../u/2.html">clrs</a>
                            </h3>
                            这家伙很懒，什么也没写！                        </div>
                    </div>
                </div>
            </div>
            <!-- E 关于作者 -->
                        
<div class="panel panel-blockimg">
    <p><img src="../../uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

<!-- S 热门资讯 -->
<div class="panel panel-default hot-article">
    <div class="panel-heading">
        <h3 class="panel-title">推荐资讯</h3>
    </div>
    <div class="panel-body">
            </div>
</div>
<!-- E 热门资讯 -->

<div class="panel panel-blockimg">
    <p><img src="../../uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

<!-- S 热门标签 -->
<div class="panel panel-default hot-tags">
    <div class="panel-heading">
        <h3 class="panel-title">热门标签</h3>
    </div>
    <div class="panel-body">
        <div class="tags">
                        <a href="../t/多标签ssh工具.html" class="tag"> <span>多标签ssh工具</span></a>
                        <a href="../t/西部数码.html" class="tag"> <span>西部数码</span></a>
                        <a href="../t/CPU.html" class="tag"> <span>CPU</span></a>
                        <a href="../t/无线WiFi网络管理.html" class="tag"> <span>无线WiFi网络管理</span></a>
                        <a href="../t/电子书设计制作.html" class="tag"> <span>电子书设计制作</span></a>
                        <a href="../t/asp.netcore.html" class="tag"> <span>asp.net core</span></a>
                        <a href="../t/数组.html" class="tag"> <span>数组</span></a>
                        <a href="../t/jenkis.html" class="tag"> <span>jenkis</span></a>
                        <a href="../t/Opencv.html" class="tag"> <span>Opencv</span></a>
                        <a href="../t/文件快传.html" class="tag"> <span>文件快传</span></a>
                        <a href="../t/日志工具.html" class="tag"> <span>日志工具</span></a>
                        <a href="../t/vs2022.html" class="tag"> <span>vs2022</span></a>
                        <a href="../t/K8s.html" class="tag"> <span>K8s</span></a>
                        <a href="../t/PC.html" class="tag"> <span>PC</span></a>
                        <a href="../t/PDF编辑软件.html" class="tag"> <span>PDF编辑软件</span></a>
                        <a href="../t/机器学习.html" class="tag"> <span>机器学习</span></a>
                        <a href="../t/投资.html" class="tag"> <span>投资</span></a>
                        <a href="../t/防火墙工具.html" class="tag"> <span>防火墙工具</span></a>
                        <a href="../t/Pandas.html" class="tag"> <span>Pandas</span></a>
                        <a href="../t/腾讯.html" class="tag"> <span>腾讯</span></a>
                        <a href="../t/云计算.html" class="tag"> <span>云计算</span></a>
                        <a href="../t/dropbox.html" class="tag"> <span>dropbox</span></a>
                        <a href="../t/学习.html" class="tag"> <span>学习</span></a>
                        <a href="../t/AI.html" class="tag"> <span>AI</span></a>
                        <a href="../t/vim.html" class="tag"> <span>vim</span></a>
                        <a href="../t/netstat.html" class="tag"> <span> netstat</span></a>
                        <a href="../t/Sublime.html" class="tag"> <span>Sublime</span></a>
                        <a href="../t/VR.html" class="tag"> <span>VR</span></a>
                        <a href="../t/数据库.html" class="tag"> <span>数据库</span></a>
                        <a href="../t/netstat.html" class="tag"> <span> Jenkins</span></a>
                    </div>
    </div>
</div>
<!-- E 热门标签 -->

<!-- S 推荐下载 -->
<div class="panel panel-default recommend-article">
    <div class="panel-heading">
        <h3 class="panel-title">推荐下载</h3>
    </div>
    <div class="panel-body">
                <div class="media media-number">
            <div class="media-left">
                <span class="num">1</span>
            </div>
            <div class="media-body">
                <a href="../app/44.html" title="Compressor 4.4.4 苹果官方出品视频解码格式转换工具">Compressor 4.4.4 苹果官方出品视频解码格式转换工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">2</span>
            </div>
            <div class="media-body">
                <a href="../app/47.html" title="Pikka 2.0.4 菜单栏屏幕取色器">Pikka 2.0.4 菜单栏屏幕取色器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">3</span>
            </div>
            <div class="media-body">
                <a href="../media/49.html" title="iShowU Instant 1.2.11 实时屏幕录制软件">iShowU Instant 1.2.11 实时屏幕录制软件</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">4</span>
            </div>
            <div class="media-body">
                <a href="../media/50.html" title="VideoProc 3.2(2019013001) 视频格式转换">VideoProc 3.2(2019013001) 视频格式转换</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">5</span>
            </div>
            <div class="media-body">
                <a href="../media/51.html" title="RightFont 5.4.1(2474) 超级好用的字体管理工具">RightFont 5.4.1(2474) 超级好用的字体管理工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">6</span>
            </div>
            <div class="media-body">
                <a href="../media/52.html" title="SPlayerX 4.1.4 射手播放器">SPlayerX 4.1.4 射手播放器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">7</span>
            </div>
            <div class="media-body">
                <a href="../media/54.html" title="Meta 1.9.2(2358) 音频元数据音乐标签信息编辑器">Meta 1.9.2(2358) 音频元数据音乐标签信息编辑器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">8</span>
            </div>
            <div class="media-body">
                <a href="../media/57.html" title="Camtasia 2018.0.8(105822) 强大且易用的视频录制和剪辑软件">Camtasia 2018.0.8(105822) 强大且易用的视频录制和剪辑软件</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">9</span>
            </div>
            <div class="media-body">
                <a href="../media/60.html" title="Cinemagraph Pro 2.7.1 专业的动态图片与视频制作工具">Cinemagraph Pro 2.7.1 专业的动态图片与视频制作工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">10</span>
            </div>
            <div class="media-body">
                <a href="../media/62.html" title="MacX Video Converter Pro 6.4.0(20181213) 视频转换器">MacX Video Converter Pro 6.4.0(20181213) 视频转换器</a>
            </div>
        </div>
            </div>
</div>
<!-- E 推荐下载 -->

<div class="panel panel-blockimg">
    <p><img src="../../uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

        </aside>
    </div>
</div>

</main>

<footer>
    <div class="container-fluid" id="footer">
        <div class="container">
            <div class="row footer-inner">
                <div class="col-md-3 col-sm-3">
                            <div class="footer-logo">
                                <a href="#"><i class="fa fa-bookmark"></i></a>
                            </div>
                            <p class="copyright"><small>© 2020-2021 穆客智能 All Rights Reserved.</small></p>
                        </div>
                        <div class="col-md-5 col-md-push-1 col-sm-5 col-sm-push-1">
                            <div class="row">
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="javascript:window.open('https://www.muker.club/cms/p/aboutus.html');">关于我们</a></li>
                                        <li><a href="#">发展历程</a></li>
                                        <li><a href="#">服务项目</a></li>
                                        <li><a href="#">团队成员</a></li>
                                    </ul>
                                </div>
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="#">新闻</a></li>
                                        <li><a href="#">资讯</a></li>
                                        <li><a href="#">推荐</a></li>
                                        <li><a href="#">博客</a></li>
                                    </ul>
                                </div>
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="#">服务</a></li>
                                        <li><a href="#">圈子</a></li>
                                        <li><a href="#">论坛</a></li>
                                        <li><a href="#">广告</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3 col-md-push-1 col-sm-push-1">
                            <div class="footer-social">
                                <a href="#"><i class="fa fa-weibo"></i></a>
                                <a href="#"><i class="fa fa-qq"></i></a>
                                <a href="#"><i class="fa fa-wechat"></i></a>
                            </div>
                        </div>
            </div>
        </div>
    </div>
</footer>

<div id="floatbtn">
    <!-- S 浮动按钮 -->

        <a href="javascript:;">
        <i class="iconfont icon-wxapp"></i>
        <div class="floatbtn-wrapper">
            <div class="qrcode"><img src="../../uploads/20210611/f75e8bc38b426f1a8ae2604807729aca.jpg"></div>
            <p>微信小程序</p>
            <p>微信扫一扫体验</p>
        </div>
    </a>
    
    <a class="hover" href="../../index/user/index.html" target="_blank">
        <i class="iconfont icon-pencil"></i>
        <em>立即<br>投稿</em>
    </a>

    <div class="floatbtn-item floatbtn-share">
        <i class="iconfont icon-share"></i>
        <div class="floatbtn-wrapper" style="height:50px;top:0">
            <div class="social-share" data-initialized="true" data-mode="prepend">
                <a href="#" class="social-share-icon icon-weibo" target="_blank"></a>
                <a href="#" class="social-share-icon icon-qq" target="_blank"></a>
                <a href="#" class="social-share-icon icon-qzone" target="_blank"></a>
                <a href="#" class="social-share-icon icon-wechat"></a>
            </div>
        </div>
    </div>

        <a href="javascript:;">
        <i class="iconfont icon-qrcode"></i>
        <div class="floatbtn-wrapper">
            <div class="qrcode"><img src="../../uploads/20210611/f75e8bc38b426f1a8ae2604807729aca.jpg"></div>
            <p>微信公众账号</p>
            <p>微信扫一扫加关注</p>
        </div>
    </a>
        <a id="feedback" class="hover" href="#comments">
        <i class="iconfont icon-feedback"></i>
        <em>发表<br>评论</em>
    </a>
    
    <a id="back-to-top" class="hover" href="javascript:;">
        <i class="iconfont icon-backtotop"></i>
        <em>返回<br>顶部</em>
    </a>
    <!-- E 浮动按钮 -->
</div>


<script type="text/javascript" src="../../assets/libs/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="../../assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../assets/libs/fastadmin-layer/dist/layer.js"></script>
<script type="text/javascript" src="../../assets/libs/art-template/dist/template-native.js"></script>
<script type="text/javascript" src="../../assets/addons/cms/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="../../assets/addons/cms/js/swiper.min.js"></script>
<script type="text/javascript" src="../../assets/addons/cms/js/share.min.js"></script>
<script type="text/javascript" src="../../assets/addons/cms/js/cms.js"></script>
<script type="text/javascript" src="../../assets/addons/cms/js/common.js"></script>

</body>
</html>
