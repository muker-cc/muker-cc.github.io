<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class=""> <!--<![endif]-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="renderer" content="webkit">
    <title>自己动手从0开始实现一个分布式 RPC 框架 - 技术改变生活</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
<meta name="referrer" content="never">
    <link rel="shortcut icon" href="https://www.muker.cc/assets/img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/css/bootstrap.min.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/libs/font-awesome/css/font-awesome.min.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/libs/fastadmin-layer/dist/theme/default/layer.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/addons/cms/css/swiper.min.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/addons/cms/css/share.min.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/addons/cms/css/iconfont.css?v=1.0.97">
    <link rel="stylesheet" media="screen" href="https://www.muker.cc/assets/addons/cms/css/common.css?v=1.0.97">

    <!--[if lt IE 9]>
    <script src="/libs/html5shiv.js"></script>
    <script src="/libs/respond.min.js"></script>
    <![endif]-->

<script async="" src='https://www.muker.cc/cdn-cgi/challenge-platform/h/g/scripts/invisible.js'></script></head>
<body class="group-page">

<header class="header">
    <!-- S 导航 -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../index.html"><img src="https://www.muker.cc/uploads/20210611/12b922043e5247eeca1b833a969486c3.png" height="40" alt=""></a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav" data-current="34">
                    <!--如果你需要自定义NAV,可使用channellist标签来完成,这里只设置了2级,如果显示无限级,请使用cms:nav标签-->
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../../index.html">首页</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../../cms2.html">新闻动态</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="javascript:window.open('https://www.clrs.me/');">博客</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="">
                        <a href="../special/hmtech.html">鸿蒙专题</a>
                        <ul class="dropdown-menu" role="menu">
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="../product.html" data-toggle="dropdown">产品中心 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../p/reload.html">充值缴费</a></li>
                                                        <li><a href="../weixingongju.html">微信工具</a></li>
                                                        <li><a href="../dianshangxitong.html">电商系统</a></li>
                                                        <li><a href="../zaixianjiaoyu.html">在线教育</a></li>
                                                        <li><a href="../quanziluntan.html">圈子论坛</a></li>
                                                        <li><a href="../neirongguanlicms.html">内容管理(CMS)</a></li>
                                                        <li><a href="../yumingchushou.html">域名出售</a></li>
                                                        <li><a href="../opensource.html">开源项目</a></li>
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown">解决方案 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../qiyejiejuefangan.html">企业解决方案</a></li>
                                                        <li><a href="../p/tongyongjiejuefangan.html">通用解决方案</a></li>
                                                    </ul>
                    </li>
                                        <!--判断是否有子级或高亮当前栏目-->
                    <li class="dropdown">
                        <a href="../download.html" data-toggle="dropdown">下载中心 <b class="caret"></b></a>
                        <ul class="dropdown-menu" role="menu">
                                                        <li><a href="../fuwuqi.html">服务器</a></li>
                                                        <li><a href="../caozuoxitong.html">操作系统</a></li>
                                                    </ul>
                    </li>
                    
                    <!--如果需要无限级请使用cms:nav标签-->
                    
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <form class="form-inline navbar-form" action="../s.html" method="get">
                            <div class="form-search hidden-sm hidden-md">
                                <input class="form-control" name="q" data-suggestion-url="/addons/cms/search/suggestion.html" type="text" id="searchinput" value="" placeholder="搜索">
                            </div>
                            <input type="hidden" name="__searchtoken__" value="6d046c2fef550faeaad87fcb63a43c91">                        </form>
                    </li>
                    <li class="dropdown">
                                                <a href="../../index/user/index1.html" class="dropdown-toggle" data-toggle="dropdown">会员<span class="hidden-sm">中心</span> <b class="caret"></b></a>
                                                <ul class="dropdown-menu">
                                                        <li><a href="../../index/user/login1.html"><i class="fa fa-sign-in fa-fw"></i> 登录</a></li>
                            <li><a href="../../index/user/register.html"><i class="fa fa-user-o fa-fw"></i> 注册</a></li>
                                                    </ul>
                    </li>
                </ul>
            </div>

        </div>
    </nav>
    <!-- E 导航 -->

</header>

<main class="main-content">
    

<div class="container" id="content-container">

    <div class="row">

        <main class="col-md-8">
            <div class="panel panel-default article-content">
                <div class="panel-heading">
                    <ol class="breadcrumb">
                        <!-- S 面包屑导航 -->
                                                <li><a href="../index.html">首页</a></li>
                                                <li><a href="../tech2.html">技术</a></li>
                                                <!-- E 面包屑导航 -->
                    </ol>
                </div>
                <div class="panel-body">
                    <div class="article-metas">
                        <h1 class="metas-title">自己动手从0开始实现一个分布式 RPC 框架</h1>

                        <div class="metas-body">
                                                        <span class="views-num">
                                <i class="fa fa-eye"></i> 348 阅读
                            </span>
                            <span class="comment-num">
                                <i class="fa fa-comments"></i> 0 评论
                            </span>
                            <span class="like-num">
                                <i class="fa fa-thumbs-o-up"></i>
                                <span class="js-like-num"> 0 点赞
                                </span>
                            </span>
                        </div>
                        
                    </div>

                    <div class="article-text">
                        <!-- S 正文 -->
                        <p>
                                                        <div class="rich_media_content " id="js_content" style="visibility: visible;">                                                                                                    <section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.625" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHjuUNcPTKMb0Ye1OPBjkcmfZJwN1ic1Xu9WuCpcMambqDOWjJNMyLIQ/640?wx_fmt=png" data-type="png" data-w="1024" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 328px !important; height: auto !important; visibility: visible !important;" title="image.png" _width="328px" class="" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHjuUNcPTKMb0Ye1OPBjkcmfZJwN1ic1Xu9WuCpcMambqDOWjJNMyLIQ/640?wx_fmt=png" crossorigin="anonymous" alt="图片" data-fail="0"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">作者 | 麓行<br style="box-sizing: border-box;"><br></span></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">前言</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">为什么要自己写一个RPC框架，我觉得从个人成长上说，如果一个程序员能清楚的了解RPC框架所具备的要素，掌握RPC框架中涉及的服务注册发现、负载均衡、序列化协议、RPC通信协议、Socket通信、异步调用、熔断降级等技术，可以全方位的提升基本素质。虽然也有相关源码，但是只看源码容易眼高手低，动手写一个才是自己真正掌握这门技术的最优路径。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">一 什么是 RPC</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">RPC（Remote Procedure Call）远程过程调用，简言之就是像调用本地方法一样调用远程服务。目前外界使用较多的有gRPC、Dubbo、Spring Cloud等。相信大家对RPC的概念都已经很熟悉了，这里不做过多介绍。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">二 分布式 RPC 框架要素</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">一款分布式RPC框架离不开三个基本要素：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">服务提供方 Serivce Provider</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">服务消费方 Servce Consumer</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">注册中心 Registery</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">围绕上面三个基本要素可以进一步扩展服务路由、负载均衡、服务熔断降级、序列化协议、通信协议等等。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.7194928684627575" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuDYD58LMlPYTVr93TiaI8xr7DqBeVMexSGTFuKZwicXrcuQCRl0VicFibuw/640?wx_fmt=png" data-type="png" data-w="631" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 224.482px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuDYD58LMlPYTVr93TiaI8xr7DqBeVMexSGTFuKZwicXrcuQCRl0VicFibuw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></h4><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">1 注册中心</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">主要是用来完成服务注册和发现的工作。虽然服务调用是服务消费方直接发向服务提供方的，但是现在服务都是集群部署，服务的提供者数量也是动态变化的，所以服务的地址也就无法预先确定。因此如何发现这些服务就需要一个统一注册中心来承载。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">2 服务提供方（RPC 服务端）</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">其需要对外提供服务接口，它需要在应用启动时连接注册中心，将服务名及其服务元数据发往注册中心。同时需要提供服务服务下线的机制。需要维护服务名和真正服务地址映射。服务端还需要启动Socket服务监听客户端请求。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">3 服务消费方（RPC 客户端）</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">客户端需要有从注册中心获取服务的基本能力，它需要在应用启动时，扫描依赖的RPC服务，并为其生成代理调用对象，同时从注册中心拉取服务元数据存入本地缓存，然后发起监听各服务的变动做到及时更新缓存。在发起服务调用时，通过代理调用对象，从本地缓存中获取服务地址列表，然后选择一种负载均衡策略筛选出一个目标地址发起调用。调用时会对请求数据进行序列化，并采用一种约定的通信协议进行socket通信。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">三 技术选型</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">1 注册中心</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">目前成熟的注册中心有Zookeeper，Nacos，Consul，Eureka，它们的主要比较如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.3380614657210402" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuBGTfKC41xw86Uvk3NiaFjLzGGn0fJcWTmiaDV2EbdhrY9ibaedqIbJ9kg/640?wx_fmt=png" data-type="png" data-w="846" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 105.475px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuBGTfKC41xw86Uvk3NiaFjLzGGn0fJcWTmiaDV2EbdhrY9ibaedqIbJ9kg/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现中支持了两种注册中心Nacos和Zookeeper，可根据配置进行切换。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">2 IO 通信框架</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现采用Netty作为底层通信框架，Netty是一个高性能事件驱动型的非阻塞的IO(NIO)框架。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">3 通信协议</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">TCP通信过程中会根据TCP缓冲区的实际情况进行包的划分，所以在业务上认为一个完整的包可能会被TCP拆分成多个包进行发送，也有可能把多个小的包封装成一个大的数据包发送，这就是所谓的TCP粘包和拆包问题。所以需要对发送的数据包封装到一种通信协议里。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">业界的主流协议的解决方案可以归纳如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">1.消息定长，例如每个报文的大小为固定长度100字节，如果不够用空格补足。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">2.在包尾特殊结束符进行分割。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">3.将消息分为消息头和消息体，消息头中包含表示消息总长度（或者消息体长度）的字段。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">很明显1，2都有些局限性，本实现采用方案3，具体协议设计如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><pre style="font-size: inherit;color: inherit;line-height: inherit;"><section style="font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;line-height: 1.75em;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;display: -webkit-box !important;"><span style="letter-spacing: 1px;">+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+&nbsp;<br><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;BYTE&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;........&nbsp;<br>+--------------------------------------------+--------+-----------------+--------+--------+--------+--------+--------+--------+-----------------+&nbsp;<br><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;magic&nbsp;|</span>&nbsp;version<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;type&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;lenth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;byte[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;<br>+--------+-----------------------------------------------------------------------------------------+--------------------------------------------+</span></span></section></pre></section><pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section></pre><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第一个字节是魔法数，比如我定义为0X35。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第二个字节代表协议版本号，以便对协议进行扩展，使用不同的协议解析器。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第三个字节是请求类型，如0代表请求1代表响应。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第四个字节表示消息长度，即此四个字节后面此长度的内容是消息content。</span></section></li></ul><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></h4><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 106, 0);">4 序列化协议</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现支持3种序列化协议，JavaSerializer、Protobuf及Hessian可以根据配置灵活选择。建议选用Protobuf，其序列化后码流小性能高，非常适合RPC调用，Google自家的gRPC也是用其作为通信协议。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">5 负载均衡</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现支持两种主要负载均衡策略，随机和轮询，其中他们都支持带权重的随机和轮询，其实也就是四种策略。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">四 整体架构</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.9592592592592593" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuE9rnGY8Tw6rogbvxaElmH34sPwjf5dmAOQ6gqwNibnpjw1B5Cgtr5fg/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 299.289px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuE9rnGY8Tw6rogbvxaElmH34sPwjf5dmAOQ6gqwNibnpjw1B5Cgtr5fg/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">五 实现</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">项目总体结构：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.8811410459587956" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuzImh1TLW6maSmOIicDAR7ZLcR5ECNx9TNfTcOOxfXncIZMMN9M5yAUg/640?wx_fmt=png" data-type="png" data-w="631" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 274.916px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuzImh1TLW6maSmOIicDAR7ZLcR5ECNx9TNfTcOOxfXncIZMMN9M5yAUg/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">1 服务注册发现</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.34548335974643424" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuWSVvPvdsCA9hRoUzR08ticTJ2eJjFuTOjv5mib6r79GIVpZn9DBorxeQ/640?wx_fmt=png" data-type="png" data-w="631" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 107.791px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuWSVvPvdsCA9hRoUzR08ticTJ2eJjFuTOjv5mib6r79GIVpZn9DBorxeQ/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Zookeeper</span></strong></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Zookeeper采用节点树的数据模型，类似linux文件系统，/，/node1，/node2 比较简单。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.646795827123696" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHuIO1QnUiblMMQicqUm4br4nZ6ZC7TAl2mVbAhk9HoLibHy2iczfXqc6kw/640?wx_fmt=png" data-type="png" data-w="671" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 201.8px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHuIO1QnUiblMMQicqUm4br4nZ6ZC7TAl2mVbAhk9HoLibHy2iczfXqc6kw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Zookeeper节点类型是Zookeeper实现很多功能的核心原理，分为持久节点临时节点、顺序节点三种类型的节点。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">我们采用的是对每个服务名创建一个</span><span style="font-size: 14px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">持久节点，服务注册时实际上就是在zookeeper中该持久节点下创建了一个临时节点，该临时节点存储了服务的IP、端口、序列化方式等。</span></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.6944444444444444" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuv0Weu59GEk1ibLmvOFVUTSqtFUQs39C9B37miavtXdFflBtNLsS7EiclA/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 216.667px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuv0Weu59GEk1ibLmvOFVUTSqtFUQs39C9B37miavtXdFflBtNLsS7EiclA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">客户端获取服务时通过获取持久节点下的临时节点列表，解析服务地址数据：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.5351851851851852" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuyxRDibpTHNgc0GLyMta9Krybn3P0Vbkcqv5nqn3ia8Sv3IYDY6YIDNicA/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 166.978px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuyxRDibpTHNgc0GLyMta9Krybn3P0Vbkcqv5nqn3ia8Sv3IYDY6YIDNicA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">客户端监听服务变化：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.3685185185185185" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHJqLOTQ6tFBu3eWZBmdVJ1tHpiaQAIqV2jlqvdibO5oRj1pOgEzKyLicA/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 114.978px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHJqLOTQ6tFBu3eWZBmdVJ1tHpiaQAIqV2jlqvdibO5oRj1pOgEzKyLicA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Nacos</span></strong></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Nacos是阿里开源的微服务管理中间件，用来完成服务之间的注册发现和配置中心，相当于Spring Cloud的Eureka+Config。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">不像Zookeeper需要利用提供的创建节点特性来实现注册发现，Nacos专门提供了注册发现功能，所以其使用更加方便简单。主要关注NamingService接口提供的三个方法registerInstance、getAllInstances、subscribe；registerInstance用来完成服务端服务注册，getAllInstances用来完成客户端服务获取，subscribe用来完成客户端服务变动监听，这里就不多做介绍，具体可参照实现源码。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">2 服务提供方 Serivce Provider</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在自动配置类OrcRpcAutoConfiguration完成注册中心和RPC启动类（RpcBootStarter）的初始化：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.3232963549920761" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuXKS2fZiaZpE8ykfWZLeE0Mib155doACdUPib9V9fwibFjsl6xCQUgfsmlA/640?wx_fmt=png" data-type="png" data-w="631" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 100.868px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuXKS2fZiaZpE8ykfWZLeE0Mib155doACdUPib9V9fwibFjsl6xCQUgfsmlA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">服务端的启动流程如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.8358662613981762" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuJql1FJibxQEfsicVoh1ljNWlt9ic528N0lg0U57qksWmHRvw8qVrFwBicA/640?wx_fmt=png" data-type="png" data-w="658" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 572.79px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuJql1FJibxQEfsicVoh1ljNWlt9ic528N0lg0U57qksWmHRvw8qVrFwBicA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">RPC启动（RpcBootStarter）：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.298148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu08mibETH6eawDHMqhp1UKlfiawqukIIX4tPALBDA72EYK4ZaZBgjEXRA/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 405.022px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu08mibETH6eawDHMqhp1UKlfiawqukIIX4tPALBDA72EYK4ZaZBgjEXRA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">上面监听Spring容器初始化事件时注意，由于Spring包含多个容器，如web容器和核心容器，他们还有父子关系，为了避免重复执行注册，只处理顶层的容器即可。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">3 服务消费方 Servce Consumer</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">服务消费方需要在应用启动完成前为依赖的服务创建好代理对象，这里有很多种方法，常见的有两种：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">一是在应用的Spring Context初始化完成事件时触发，扫描所有的Bean，将Bean中带有OrcRpcConsumer注解的field获取到，然后创建field类型的代理对象，创建完成后，将代理对象set给此field。后续就通过该代理对象创建服务端连接，并发起调用。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">二是通过Spring的BeanFactoryPostProcessor，其可以对bean的定义BeanDefinition(配置元数据)进行处理；Spring IOC会在容器实例化任何其他bean之前运行BeanFactoryPostProcessor读取BeanDefinition，可以修改这些BeanDefinition，也可以新增一些BeanDefinition。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现也采用第二种方式，处理流程如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.173148148148148" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfutNuMNaGLYicDwbM41UacEYbVqllt4xHL7oh7d7qbEgZiaxq19uFcJoxg/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 366.022px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfutNuMNaGLYicDwbM41UacEYbVqllt4xHL7oh7d7qbEgZiaxq19uFcJoxg/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">BeanFactoryPostProcessor的主要实现：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><br></span></section><section style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><pre style="font-size: inherit;color: inherit;line-height: inherit;"><section style="font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;line-height: 1.75em;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;display: -webkit-box !important;"><span style="letter-spacing: 1px;">&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(91, 218, 237);overflow-wrap: inherit !important;word-break: inherit !important;">@Override</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">postProcessBeanFactory</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(ConfigurableListableBeanFactory&nbsp;beanFactory)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">throws</span>&nbsp;BeansException&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">this</span>.beanFactory&nbsp;=&nbsp;beanFactory;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postProcessRpcConsumerBeanFactory(beanFactory,&nbsp;(BeanDefinitionRegistry)beanFactory);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">postProcessRpcConsumerBeanFactory</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(ConfigurableListableBeanFactory&nbsp;beanFactory,&nbsp;BeanDefinitionRegistry&nbsp;beanDefinitionRegistry)</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;beanDefinitionNames&nbsp;=&nbsp;beanFactory.getBeanDefinitionNames();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">int</span>&nbsp;len&nbsp;=&nbsp;beanDefinitionNames.length;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">for</span>&nbsp;(<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">int</span>&nbsp;i&nbsp;=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;">0</span>;&nbsp;i&nbsp;&lt;&nbsp;len;&nbsp;i++)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;beanDefinitionName&nbsp;=&nbsp;beanDefinitionNames[i];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeanDefinition&nbsp;beanDefinition&nbsp;=&nbsp;beanFactory.getBeanDefinition(beanDefinitionName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;beanClassName&nbsp;=&nbsp;beanDefinition.getBeanClassName();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(beanClassName&nbsp;!=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;&nbsp;clazz&nbsp;=&nbsp;ClassUtils.resolveClassName(beanClassName,&nbsp;classLoader);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReflectionUtils.doWithFields(clazz,&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;FieldCallback()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(91, 218, 237);overflow-wrap: inherit !important;word-break: inherit !important;">@Override</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">doWith</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(Field&nbsp;field)</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">throws</span>&nbsp;IllegalArgumentException,&nbsp;IllegalAccessException&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parseField(field);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;Entry&lt;String,&nbsp;BeanDefinition&gt;&gt;&nbsp;it&nbsp;=&nbsp;beanDefinitions.entrySet().iterator();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">while</span>&nbsp;(it.hasNext())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&lt;String,&nbsp;BeanDefinition&gt;&nbsp;entry&nbsp;=&nbsp;it.next();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(context.containsBean(entry.getKey()))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">throw</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;IllegalArgumentException(<span style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);overflow-wrap: inherit !important;word-break: inherit !important;">"Spring&nbsp;context&nbsp;already&nbsp;has&nbsp;a&nbsp;bean&nbsp;named&nbsp;"</span>&nbsp;+&nbsp;entry.getKey());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beanDefinitionRegistry.registerBeanDefinition(entry.getKey(),&nbsp;entry.getValue());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span style="font-size: inherit;line-height: inherit;color: rgb(238, 220, 112);overflow-wrap: inherit !important;word-break: inherit !important;">"register&nbsp;OrcRpcConsumerBean&nbsp;definition:&nbsp;{}"</span>,&nbsp;entry.getKey());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">parseField</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(Field&nbsp;field)</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;获取所有OrcRpcConsumer注解</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrcRpcConsumer&nbsp;orcRpcConsumer&nbsp;=&nbsp;field.getAnnotation(OrcRpcConsumer.class);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(orcRpcConsumer&nbsp;!=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;使用field的类型和OrcRpcConsumer注解一起生成BeanDefinition</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrcRpcConsumerBeanDefinitionBuilder&nbsp;beanDefinitionBuilder&nbsp;=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;OrcRpcConsumerBeanDefinitionBuilder(field.getType(),&nbsp;orcRpcConsumer);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeanDefinition&nbsp;beanDefinition&nbsp;=&nbsp;beanDefinitionBuilder.build();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beanDefinitions.put(field.getName(),&nbsp;beanDefinition);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br></span></section></pre></section><pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><br></span></section></pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">ProxyFactory的主要实现：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><pre><section style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><pre style="font-size: inherit;color: inherit;line-height: inherit;"><section style="font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;line-height: 1.75em;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;display: -webkit-box !important;"><span style="letter-spacing: 1px;"><span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">JdkProxyFactory</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">implements</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">ProxyFactory</span></span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(91, 218, 237);overflow-wrap: inherit !important;word-break: inherit !important;">@Override</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;Object&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">getProxy</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(ServiceMetadata&nbsp;serviceMetadata)</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;Proxy<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.newProxyInstance(serviceMetadata.getClazz().getClassLoader(),&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;Class[]&nbsp;{serviceMetadata.getClazz()},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;ClientInvocationHandler(serviceMetadata));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;<span style="font-size: inherit;color: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">class</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">ClientInvocationHandler</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">implements</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">InvocationHandler</span>&nbsp;</span>{<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">private</span>&nbsp;ServiceMetadata&nbsp;serviceMetadata;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">ClientInvocationHandler</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(ServiceMetadata&nbsp;serviceMetadata)</span>&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">this</span>.serviceMetadata&nbsp;=&nbsp;serviceMetadata;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(91, 218, 237);overflow-wrap: inherit !important;word-break: inherit !important;">@Override</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">public</span>&nbsp;Object&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">invoke</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(Object&nbsp;proxy,&nbsp;Method&nbsp;method,&nbsp;Object[]&nbsp;args)</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">throws</span>&nbsp;Throwable&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;serviceId&nbsp;=&nbsp;ServiceUtils.getServiceId(serviceMetadata);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;通过负载均衡器选取一个服务提供方地址</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServiceURL&nbsp;service&nbsp;=&nbsp;InvocationServiceSelector.select(serviceMetadata);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrcRpcRequest&nbsp;request&nbsp;=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;OrcRpcRequest();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setMethod(method.getName());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setParameterTypes(method.getParameterTypes());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setParameters(args);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setRequestId(UUID.randomUUID().toString());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.setServiceId(serviceId);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrcRpcResponse&nbsp;response&nbsp;=&nbsp;InvocationClientContainer.getInvocationClient(service.getServerNet()).invoke(request,&nbsp;service);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(response.getStatus()&nbsp;==&nbsp;RpcStatusEnum.SUCCESS)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">return</span>&nbsp;response.getData();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">else</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(response.getException()&nbsp;!=&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">null</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">throw</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;OrcRpcException(response.getException().getMessage());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">throw</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;">new</span>&nbsp;OrcRpcException(response.getStatus().name());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></span></section></pre></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><br></span></section></pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">本实现只使用JDK动态代理，也可以使用cglib或Javassist实现以获得更好的性能，JdkProxyFactory中。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><h4 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 14px;">4 IO 模块</span></strong></span></h4><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.4643423137876387" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu5ibRJmQjKcJfgou5mP00kFeqUHVib4Y5yY4Da6stPaWnFL3tWIH39hJw/640?wx_fmt=png" data-type="png" data-w="631" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 144.875px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu5ibRJmQjKcJfgou5mP00kFeqUHVib4Y5yY4Da6stPaWnFL3tWIH39hJw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">UML图如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.6787037037037037" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuna5ONCXdojUuOM8N2kvMWkkt9xqnDngquFSLlXA4Ulfy2DjO5lpPpw/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 211.756px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuna5ONCXdojUuOM8N2kvMWkkt9xqnDngquFSLlXA4Ulfy2DjO5lpPpw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">结构比较清晰，分三大模块：客户端</span><span style="font-size: 14px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">调用适配模块、服务端请求响应适配模块和Netty IO服务模块。</span></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">客户端调用适配模块</span></strong></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">此模块比较简单，主要是为客户端调用时建立服务端接，并将连接存入缓存，避免后续同服务调用重复建立连接，连接建立成功后发起调用。下面是DefaultInvocationClient的实现：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.9203703703703704" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfunvMhL6Bysib49oPQ5ia3icrID4Tzy7qPMwACT39ZeC5ibEI41rOgibsh6iaw/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 287.156px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfunvMhL6Bysib49oPQ5ia3icrID4Tzy7qPMwACT39ZeC5ibEI41rOgibsh6iaw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">服务端请求响应适配模块</span></strong></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">服务请求响应模块也比较简单，是根据请求中的服务名，从缓存中获取服务元数据，然后从请求中获取调用的方法和参数类型信息，反射获取调用方法信息。然后从spring context中获取bean进行反射调用。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="0.5814814814814815" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuGNWibTyIfJOlQjZOuCTiaTKsHmMU5U6fjVfqvNVEQFfyj7cTyXxTkTbg/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 181.422px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuGNWibTyIfJOlQjZOuCTiaTKsHmMU5U6fjVfqvNVEQFfyj7cTyXxTkTbg/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Netty IO服务模块</span></strong></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Netty IO服务模块是核心，稍复杂一些，客户端和服务端主要处理流程如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.1111111111111112" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuIoldY7Sq51jwmEGDwXW2siacPR85v3NV2WTGWFmib9qPicKbicKTkiaicORA/640?wx_fmt=png" data-type="png" data-w="1080" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 346.667px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuIoldY7Sq51jwmEGDwXW2siacPR85v3NV2WTGWFmib9qPicKbicKTkiaicORA/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">其中，重点是这四个类的实现：NettyNetClient、NettyNetServer、NettyClientChannelRequestHandler和NettyServerChannelRequestHandler，上面的UML图和下面流程图基本上讲清楚了它们的关系和一次请求的处理流程，这里就不再展开了。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">下面重点讲一下编码解码器。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在技术选型章节中，提及了采用的通信协议，定义了私有的RPC协议：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><pre style="font-size: inherit;color: inherit;line-height: inherit;"><section style="font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;line-height: 1.75em;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;display: -webkit-box !important;"><span style="letter-spacing: 1px;">+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+&nbsp;<br><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;BYTE&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;........&nbsp;<br>+--------------------------------------------+--------+-----------------+--------+--------+--------+--------+--------+--------+-----------------+&nbsp;<br><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;magic&nbsp;|</span>&nbsp;version<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;type&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;lenth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;byte[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">|&nbsp;<br>+--------+-----------------------------------------------------------------------------------------+--------------------------------------------+</span></span></section></pre></section><pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section></pre><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第一个字节是魔法数定义为0X35。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第二个字节代表协议版本号。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第三个字节是请求类型，0代表请求1代表响应。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><ul class="list-paddingleft-2" style="list-style-type: disc;margin-left: 8px;margin-right: 8px;"><li style="letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">第四个字节表示消息长度，即此四个字节后面此长度的内容是消息content。</span></section></li></ul><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">编码器的实现如下：<br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><pre><section style="font-size: 16px;color: rgb(62, 62, 62);line-height: 1.6;letter-spacing: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><pre style="font-size: inherit;color: inherit;line-height: inherit;"><section style="font-size: 14px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;margin-left: 8px;margin-right: 8px;line-height: 1.75em;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;display: -webkit-box !important;"><span style="letter-spacing: 1px;"><span style="font-size: inherit;line-height: inherit;color: rgb(91, 218, 237);overflow-wrap: inherit !important;word-break: inherit !important;">@Override</span><br><span style="font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;"><span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">protected</span>&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">void</span>&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(165, 218, 45);overflow-wrap: inherit !important;word-break: inherit !important;">encode</span><span style="font-size: inherit;line-height: inherit;color: rgb(255, 152, 35);overflow-wrap: inherit !important;word-break: inherit !important;">(ChannelHandlerContext&nbsp;channelHandlerContext,&nbsp;ProtocolMsg&nbsp;protocolMsg,&nbsp;ByteBuf&nbsp;byteBuf)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;overflow-wrap: inherit !important;word-break: inherit !important;">throws</span>&nbsp;Exception&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;写入协议头</span><br>&nbsp;&nbsp;&nbsp;&nbsp;byteBuf.writeByte(ProtocolConstant.MAGIC);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;写入版本</span><br>&nbsp;&nbsp;&nbsp;&nbsp;byteBuf.writeByte(ProtocolConstant.DEFAULT_VERSION);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;写入请求类型</span><br>&nbsp;&nbsp;&nbsp;&nbsp;byteBuf.writeByte(protocolMsg.getMsgType());<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;写入消息长度</span><br>&nbsp;&nbsp;&nbsp;&nbsp;byteBuf.writeInt(protocolMsg.getContent().length);<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: inherit;line-height: inherit;color: rgb(128, 128, 128);overflow-wrap: inherit !important;word-break: inherit !important;">//&nbsp;写入消息内容</span><br>&nbsp;&nbsp;&nbsp;&nbsp;byteBuf.writeBytes(protocolMsg.getContent());<br>}</span></section></pre></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section></pre><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">解码器的实现如下：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.7039877300613497" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfumgeVvgXMEluxgEVzjzH4YKib7I7ns5KibqVyIIs2jHHNSEhbSYLoZPgQ/640?wx_fmt=png" data-type="png" data-w="1304" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 531.644px !important;" title="1_副本.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfumgeVvgXMEluxgEVzjzH4YKib7I7ns5KibqVyIIs2jHHNSEhbSYLoZPgQ/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">六 测试</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在本人MacBook Pro 13寸，4核I5，16g内存，使用Nacos注册中心，启动一个服务器，一个客户端情况下，采用轮询负载均衡策略的情况下，使用Apache ab测试。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在启用8个线程发起10000个请求的情况下，可以做到 18秒完成所有请求，qps550：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.4270353302611367" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu7IHXHjIpvlB8dncKl9SF9RS5J3attOljgric49BBGeDuEKoxibLiaPNRQ/640?wx_fmt=png" data-type="png" data-w="651" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 445.235px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfu7IHXHjIpvlB8dncKl9SF9RS5J3attOljgric49BBGeDuEKoxibLiaPNRQ/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在启用100个线程发起10000个请求的情况下，可以做到 13.8秒完成所有请求，qps724：</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><img data-ratio="1.3855606758832566" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuZWAhIsxoFeTbA4lhW2wnEpuMQaI6ApjQsHgUoVwYS9gq0OmDddNIVw/640?wx_fmt=png" data-type="png" data-w="651" style="box-sizing: content-box; border-width: 0px; border-style: none; border-color: initial; width: 312px !important; height: 432.295px !important;" title="image.png" _width="328px" class="img_loading" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuZWAhIsxoFeTbA4lhW2wnEpuMQaI6ApjQsHgUoVwYS9gq0OmDddNIVw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><h3 style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></h3><h3 style="text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="color: rgb(255, 106, 0);letter-spacing: 1px;"><strong><span style="color: rgb(255, 106, 0);font-size: 16px;">七 总结</span></strong></span></h3><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><br></span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在实现这个RPC框架的过程中，我也重新学习了很多知识，比如通信协议、IO框架等。也横向学习了当前最热的gRPC，借此又看了很多相关的源码，收获很大。后续我也会继续维护升级这个框架，比如引入熔断降级等机制，做到持续学习持续进步。</span></section><section style="margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 106, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;">精彩推荐</span></strong><strong style="max-width: 100%;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"></strong></span></section><p style="margin-right: 8px;margin-left: 8px;white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></p><section style="white-space: normal;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><a target="_blank" href="javascript:window.open('https://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;mid=2658376255&amp;idx=1&amp;sn=36ed6c7790dbd1fab32d527c2ba61bea&amp;chksm=f2d55151c5a2d84763b24e2dd14de9f4f50aa0c1fef705f2b449d975e8a5058f87a7d99fc58a&amp;scene=21#wechat_redirect');" textvalue="你已选中了添加链接的内容" data-itemshowtype="11" tab="innerlink" data-linktype="1" style="inset: auto;letter-spacing: 1px;"><span style="inset: auto;letter-spacing: 1px;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="inset: auto;margin: 0px;"><img class="rich_pages img_loading" data-galleryid="" data-ratio="0.4255555555555556" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWJDtINCrwYxicib5RmvdKA5MugT6bnT91q2TszFBE0h4r8YzVPliaT2nq348iclXos46nRTO6Sz1U142A/640?wx_fmt=jpeg" data-type="jpeg" data-w="900" style="margin: 0px; width: 312px !important; height: 133.922px !important;" _width="328px" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWJDtINCrwYxicib5RmvdKA5MugT6bnT91q2TszFBE0h4r8YzVPliaT2nq348iclXos46nRTO6Sz1U142A/640?wx_fmt=jpeg" crossorigin="anonymous" alt="图片"></span></span></a></section><h2 style="white-space: normal;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><a target="_blank" href="javascript:window.open('https://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;mid=2658376255&amp;idx=1&amp;sn=36ed6c7790dbd1fab32d527c2ba61bea&amp;chksm=f2d55151c5a2d84763b24e2dd14de9f4f50aa0c1fef705f2b449d975e8a5058f87a7d99fc58a&amp;scene=21#wechat_redirect');" textvalue="云原生不仅颠覆了技术栈，背后的每个岗位也在悄然发生改变" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="font-size: 14px;letter-spacing: 1px;"><span style="letter-spacing: 1px;">云原生不仅颠覆技术栈，背后每个岗位也在悄然发生改变</span></a></h2><section style="white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></section><section style="white-space: normal;max-width: 100%;min-height: 1em;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a target="_blank" href="javascript:window.open('https://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;mid=2658376246&amp;idx=1&amp;sn=1e22d0b0d241dd3c7d674029b66985f1&amp;chksm=f2d55158c5a2d84e93b59bdd7cf6a9adf196b579d8793e0f109ad2d1c91b0b1b32c5777dbd87&amp;scene=21#wechat_redirect');" textvalue="你已选中了添加链接的内容" data-itemshowtype="11" tab="innerlink" data-linktype="1" hasload="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;line-height: 0;max-width: 100%;inset: auto;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="line-height: 0;max-width: 100%;inset: auto;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="inset: auto;margin: 0px;"><img class="rich_pages img_loading" data-croporisrc="https://mmbiz.qlogo.cn/mmbiz_png/tMJtfgIIibWJtqKb0LUPfQ59uPmCdDXtw07zVBOiblgvqPyTZ84ia7QPyjHicngfl3og4ZCG4o3u4odo9k0ZFrxw2A/0?wx_fmt=png" data-cropx1="0" data-cropx2="1024" data-cropy1="60.23529411764706" data-cropy2="513.7716262975779" data-ratio="0.4423828125" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWJDtINCrwYxicib5RmvdKA5MupI7HS5I9DgkT4aCibheUhgIrkusWe36kJWmksboFvmnbUH26BnJnkvw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1024" style="border-width: 0px; border-style: initial; border-color: initial; margin: 0px; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 312px !important; height: 138.023px !important;" _width="328px" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_jpg/tMJtfgIIibWJDtINCrwYxicib5RmvdKA5MupI7HS5I9DgkT4aCibheUhgIrkusWe36kJWmksboFvmnbUH26BnJnkvw/640?wx_fmt=jpeg" crossorigin="anonymous" alt="图片"></span></span></a></section><h2 style="white-space: normal;max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a target="_blank" href="javascript:window.open('https://mp.weixin.qq.com/s?__biz=MzI0NTE4NjA0OQ==&amp;mid=2658376246&amp;idx=1&amp;sn=1e22d0b0d241dd3c7d674029b66985f1&amp;chksm=f2d55158c5a2d84e93b59bdd7cf6a9adf196b579d8793e0f109ad2d1c91b0b1b32c5777dbd87&amp;scene=21#wechat_redirect');" textvalue="重温设计模式之 Factory" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;max-width: 100%;font-size: 14px;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="letter-spacing: 1px;">重温设计模式之 Factory</span></a></h2><section style="white-space: normal;margin-left: 8px;margin-right: 8px;line-height: 1.75em;"><br></section><section style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="__bg_gif img_loading" data-ratio="1" data-src="https://mmbiz.qpic.cn/mmbiz_gif/V3ll7FMyGyMqQC7JRNgVZlsiaJibSyp27USlRia194K6Nqfvz8Wblg7HDceOn4Y3MekppS14lazRZTKLdt2BHuYGA/640?wx_fmt=gif" data-type="gif" data-w="55" style="border-width: 1px; border-style: solid; border-color: rgb(238, 237, 235); background-color: rgb(238, 237, 235); background-size: 22px; background-position: center center; background-repeat: no-repeat; letter-spacing: 0.544px; font-family: Optima-Regular, PingFangTC-light; vertical-align: top; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 55px !important; height: 55px !important;" width="55" _width="55px" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_gif/V3ll7FMyGyMqQC7JRNgVZlsiaJibSyp27USlRia194K6Nqfvz8Wblg7HDceOn4Y3MekppS14lazRZTKLdt2BHuYGA/640?wx_fmt=gif" data-order="0" alt="图片"></section><section style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="rich_pages img_loading" data-backh="369" data-backw="562" data-ratio="0.6560402684563759" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJS5ypHXziazYNiczwvPib2mYETp7XgNIEvR4RIaicwBXNG4fw7wadhooQ8zmS8LUToZ9BrcDKgXu0Hfw/640?wx_fmt=png" data-type="png" data-w="596" style="background-color: rgb(238, 237, 235); border-width: 1px; border-style: solid; border-color: rgb(238, 237, 235); background-size: 22px; background-position: center center; background-repeat: no-repeat; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 312px !important; height: 205.372px !important;" width="661" _width="328px" src="https://www.muker.cc/index/index/wx?img=https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJS5ypHXziazYNiczwvPib2mYETp7XgNIEvR4RIaicwBXNG4fw7wadhooQ8zmS8LUToZ9BrcDKgXu0Hfw/640?wx_fmt=png" crossorigin="anonymous" alt="图片"></section><section style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></section><section style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: center;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></section><section style="white-space: normal;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;margin-left: 8px;margin-right: 8px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;background-color: rgb(255, 106, 0);font-size: 14px;letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(255, 255, 255);font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 13px;letter-spacing: 0.544px;box-sizing: border-box !important;overflow-wrap: break-word !important;">↓ 点击这里 查看作者更多好文！</strong></span></section>                </div><div>来源:https://mp.weixin.qq.com/s/dkb5x8njAAA2JQj_qyWoyg</div>                        
                        <!-- E 正文 -->
                    </div>

                    <!-- S 付费阅读 -->
<!-- E 付费阅读 -->


                    <!-- S 点赞 -->
<div class="article-donate">
    <a href="javascript:" class="btn btn-primary btn-like btn-lg" data-action="vote" data-type="like" data-id="221" data-tag="archives"><i class="fa fa-thumbs-up"></i> 点赞(<span>0</span>)</a>
    <a href="javascript:" class="btn btn-outline-primary btn-donate btn-lg" data-action="donate" data-id="221" data-image="/uploads/20210611/c81a0eac1c3e5de3ecee547f7d6afebb.png"><i class="fa fa-cny"></i> 打赏</a>
</div>
<!-- E 点赞 -->


                    

<!-- S 分享 -->
<div class="social-share text-center mt-2 mb-1" data-initialized="true" data-mode="prepend" data-image="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHjuUNcPTKMb0Ye1OPBjkcmfZJwN1ic1Xu9WuCpcMambqDOWjJNMyLIQ/640">
    <a href="javascript:;" class="social-share-icon icon-heart addbookbark" data-type="archives" data-aid="221" data-action="../../addons/cms/ajax/collection.html"></a>
    <a href="#" class="social-share-icon icon-weibo" target="_blank"></a>
    <a href="#" class="social-share-icon icon-qq" target="_blank"></a>
    <a href="#" class="social-share-icon icon-qzone" target="_blank"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
</div>

<!-- E 分享 -->


                    <div class="entry-meta">
    <ul>
        <!-- S 归档 -->
        <li>本文分类：<a href="../tech2.html">技术</a></li>
        <li>本文标签：<a href="../t/rpc.html" class="tag" rel="tag">rpc</a></li>
        <li>浏览次数：<span>348</span> 次浏览</li>
        <li>发布日期：2021-07-10 08:09:49</li>
        <li>本文链接：<a href=""></a></li>
        <!-- S 归档 -->
    </ul>

    <ul class="article-prevnext">
        <!-- S 上一篇下一篇 -->
                <li>
            <span>上一篇 &gt;</span>
            <a href="220.html">让16 个写代码的好习惯变成你的财富</a>
        </li>
                <li>
            <span>下一篇 &gt;</span>
            <a href="222.html">用开源移动应用 PlantNet 来识别花草和树木 | Linux 中国</a>
        </li>
                <!-- E 上一篇下一篇 -->
    </ul>
</div>


                    <div class="related-article">
    <div class="row">
        <!-- S 相关文章 -->
                <div class="col-sm-3 col-xs-6">
            <a href="" class="img-zoom">
                <div class="embed-responsive embed-responsive-4by3">
                    <img src="https://mmbiz.qpic.cn/mmbiz_png/tMJtfgIIibWJPfEz0b82zpSNiaMGjoXTfuHjuUNcPTKMb0Ye1OPBjkcmfZJwN1ic1Xu9WuCpcMambqDOWjJNMyLIQ/640" alt="自己动手从0开始实现一个分布式 RPC 框架" class="embed-responsive-item">
                </div>
            </a>
            <h5 class="text-center"><a href="">自己动手从0开始实现一个分布式 RPC 框架</a></h5>
        </div>
                <!-- E 相关文章 -->
    </div>
</div>


                    <div class="clearfix"></div>
                </div>
            </div>

            <div class="panel panel-default" id="comments">
                <div class="panel-heading">
                    <h3 class="panel-title">评论列表                        <small>共有 <span>0</span> 条评论</small>
                    </h3>
                </div>
                <div class="panel-body">
                                        <div id="comment-container">
    <!-- S 评论列表 -->
    <div id="commentlist">
                <div class="loadmore loadmore-line loadmore-nodata"><span class="loadmore-tips">暂无评论</span></div>
            </div>
    <!-- E 评论列表 -->

    <!-- S 评论分页 -->
    <div id="commentpager" class="text-center">
            </div>
    <!-- E 评论分页 -->

    <!-- S 发表评论 -->
    <div id="postcomment">
        <h3>发表评论 <a href="javascript:;">
            <small>取消回复</small>
        </a></h3>
        <form action="../../addons/cms/comment/post.html" method="post" id="postform">
            <input type="hidden" name="__token__" value="6d046c2fef550faeaad87fcb63a43c91">            <input type="hidden" name="type" value="archives">
            <input type="hidden" name="aid" value="221">
            <input type="hidden" name="pid" id="pid" value="0">
            <div class="form-group">
                <textarea name="content" class="form-control" disabled="" placeholder="请登录后再发表评论" id="commentcontent" cols="6" rows="5" tabindex="4"></textarea>
            </div>
                        <div class="form-group">
                <a href="../../index/user/login1.html" class="btn btn-primary">登录</a>
                <a href="../../index/user/register.html" class="btn btn-outline-primary">注册新账号</a>
            </div>
                    </form>
    </div>
    <!-- E 发表评论 -->
</div>

                                    </div>
            </div>

        </main>

        <aside class="col-xs-12 col-sm-4">
                        <!-- S 关于作者 -->
            <div class="panel panel-default about-author" data-id="2" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
                <meta itemprop="name" content="clrs">
                <meta itemprop="image" content="/uploads/20210611/1c33f3b2e46303967d5fa6e70be59f24.png">
                <meta itemprop="url" content="/u/2">
                <div class="panel-heading">
                    <h3 class="panel-title">关于作者</h3>
                </div>
                <div class="panel-body">
                    <div class="media">
                        <div class="media-left">
                            <a href="../../u/2.html">
                                <img class="media-object img-circle img-medium" style="width:64px;height:64px;" src="https://www.muker.cc/uploads/20210611/1c33f3b2e46303967d5fa6e70be59f24.png" data-holder-rendered="true">
                            </a>
                        </div>
                        <div class="media-body">
                            <h3 style="margin-top:10px;" class="media-heading">
                                <a href="../../u/2.html">clrs</a>
                            </h3>
                            这家伙很懒，什么也没写！                        </div>
                    </div>
                </div>
            </div>
            <!-- E 关于作者 -->
                        
<div class="panel panel-blockimg">
    <p><img src="https://www.muker.cc/uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

<!-- S 热门资讯 -->
<div class="panel panel-default hot-article">
    <div class="panel-heading">
        <h3 class="panel-title">推荐资讯</h3>
    </div>
    <div class="panel-body">
            </div>
</div>
<!-- E 热门资讯 -->

<div class="panel panel-blockimg">
    <p><img src="https://www.muker.cc/uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

<!-- S 热门标签 -->
<div class="panel panel-default hot-tags">
    <div class="panel-heading">
        <h3 class="panel-title">热门标签</h3>
    </div>
    <div class="panel-body">
        <div class="tags">
                        <a href="../t/驰为.html" class="tag"> <span>驰为</span></a>
                        <a href="../t/树莓派.html" class="tag"> <span>树莓派</span></a>
                        <a href="../t/pc.html" class="tag"> <span>PC</span></a>
                        <a href="../t/鸿蒙.html" class="tag"> <span>鸿蒙</span></a>
                        <a href="../t/jwt.html" class="tag"> <span>JWT</span></a>
                        <a href="../t/视频转换器.html" class="tag"> <span>视频转换器</span></a>
                        <a href="../t/.net.html" class="tag"> <span>. net</span></a>
                        <a href="../t/虚拟录音.html" class="tag"> <span>虚拟录音</span></a>
                        <a href="../t/vr.html" class="tag"> <span>VR</span></a>
                        <a href="../t/devops.html" class="tag"> <span>DevOps</span></a>
                        <a href="../t/视频制作.html" class="tag"> <span>视频制作</span></a>
                        <a href="../t/ddd.html" class="tag"> <span>DDD</span></a>
                        <a href="../t/博客写作.html" class="tag"> <span>博客写作</span></a>
                        <a href="../t/音乐播放器.html" class="tag"> <span>音乐播放器</span></a>
                        <a href="../t/.netcore.html" class="tag"> <span>. net core</span></a>
                        <a href="../t/dropbox.html" class="tag"> <span>dropbox</span></a>
                        <a href="../t/ftp工具.html" class="tag"> <span>FTP工具</span></a>
                        <a href="../t/音频录制.html" class="tag"> <span>音频录制</span></a>
                        <a href="../t/golang.html" class="tag"> <span>Golang</span></a>
                        <a href="../t/无线wifi网络管理.html" class="tag"> <span>无线WiFi网络管理</span></a>
                        <a href="../t/投资.html" class="tag"> <span>投资</span></a>
                        <a href="../t/gitlab.html" class="tag"> <span>gitlab</span></a>
                        <a href="../t/互联网.html" class="tag"> <span>互联网</span></a>
                        <a href="../t/宏基.html" class="tag"> <span>宏基</span></a>
                        <a href="../t/小米.html" class="tag"> <span> 小米</span></a>
                        <a href="../t/线程.html" class="tag"> <span> 线程</span></a>
                        <a href="../t/.net1.html" class="tag"> <span>.net</span></a>
                        <a href="../t/日志工具.html" class="tag"> <span>日志工具</span></a>
                        <a href="../t/开源.html" class="tag"> <span>开源</span></a>
                        <a href="../t/美团.html" class="tag"> <span>美团</span></a>
                    </div>
    </div>
</div>
<!-- E 热门标签 -->

<!-- S 推荐下载 -->
<div class="panel panel-default recommend-article">
    <div class="panel-heading">
        <h3 class="panel-title">推荐下载</h3>
    </div>
    <div class="panel-body">
                <div class="media media-number">
            <div class="media-left">
                <span class="num">1</span>
            </div>
            <div class="media-body">
                <a href="../app/44.html" title="Compressor 4.4.4 苹果官方出品视频解码格式转换工具">Compressor 4.4.4 苹果官方出品视频解码格式转换工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">2</span>
            </div>
            <div class="media-body">
                <a href="../app/47.html" title="Pikka 2.0.4 菜单栏屏幕取色器">Pikka 2.0.4 菜单栏屏幕取色器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">3</span>
            </div>
            <div class="media-body">
                <a href="../media/49.html" title="iShowU Instant 1.2.11 实时屏幕录制软件">iShowU Instant 1.2.11 实时屏幕录制软件</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">4</span>
            </div>
            <div class="media-body">
                <a href="../media/50.html" title="VideoProc 3.2(2019013001) 视频格式转换">VideoProc 3.2(2019013001) 视频格式转换</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">5</span>
            </div>
            <div class="media-body">
                <a href="../media/51.html" title="RightFont 5.4.1(2474) 超级好用的字体管理工具">RightFont 5.4.1(2474) 超级好用的字体管理工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">6</span>
            </div>
            <div class="media-body">
                <a href="../media/52.html" title="SPlayerX 4.1.4 射手播放器">SPlayerX 4.1.4 射手播放器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">7</span>
            </div>
            <div class="media-body">
                <a href="../media/54.html" title="Meta 1.9.2(2358) 音频元数据音乐标签信息编辑器">Meta 1.9.2(2358) 音频元数据音乐标签信息编辑器</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">8</span>
            </div>
            <div class="media-body">
                <a href="../media/57.html" title="Camtasia 2018.0.8(105822) 强大且易用的视频录制和剪辑软件">Camtasia 2018.0.8(105822) 强大且易用的视频录制和剪辑软件</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">9</span>
            </div>
            <div class="media-body">
                <a href="../media/60.html" title="Cinemagraph Pro 2.7.1 专业的动态图片与视频制作工具">Cinemagraph Pro 2.7.1 专业的动态图片与视频制作工具</a>
            </div>
        </div>
                <div class="media media-number">
            <div class="media-left">
                <span class="num">10</span>
            </div>
            <div class="media-body">
                <a href="../media/62.html" title="MacX Video Converter Pro 6.4.0(20181213) 视频转换器">MacX Video Converter Pro 6.4.0(20181213) 视频转换器</a>
            </div>
        </div>
            </div>
</div>
<!-- E 推荐下载 -->

<div class="panel panel-blockimg">
    <p><img src="https://www.muker.cc/uploads/20210616/89c87bce97dfae0c305ab5741caf5259.png"></p>
</div>

        </aside>
    </div>
</div>

</main>

<footer>
    <div class="container-fluid" id="footer">
        <div class="container">
            <div class="row footer-inner">
                <div class="col-md-3 col-sm-3">
                            <div class="footer-logo">
                                <a href="#"><i class="fa fa-bookmark"></i></a>
                            </div>
                            <p class="copyright"><small>© 2020-2021 穆客智能 All Rights Reserved.</small></p>
                        </div>
                        <div class="col-md-5 col-md-push-1 col-sm-5 col-sm-push-1">
                            <div class="row">
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="javascript:window.open('https://www.muker.club/cms/p/aboutus.html');">关于我们</a></li>
                                        <li><a href="#">发展历程</a></li>
                                        <li><a href="#">服务项目</a></li>
                                        <li><a href="#">团队成员</a></li>
                                    </ul>
                                </div>
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="#">新闻</a></li>
                                        <li><a href="#">资讯</a></li>
                                        <li><a href="#">推荐</a></li>
                                        <li><a href="#">博客</a></li>
                                    </ul>
                                </div>
                                <div class="col-xs-4">
                                    <ul class="links">
                                        <li><a href="#">服务</a></li>
                                        <li><a href="#">圈子</a></li>
                                        <li><a href="#">论坛</a></li>
                                        <li><a href="#">广告</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-3 col-md-push-1 col-sm-push-1">
                            <div class="footer-social">
                                <a href="#"><i class="fa fa-weibo"></i></a>
                                <a href="#"><i class="fa fa-qq"></i></a>
                                <a href="#"><i class="fa fa-wechat"></i></a>
                            </div>
                        </div>
            </div>
        </div>
    </div>
</footer>

<div id="floatbtn">
    <!-- S 浮动按钮 -->

        <a href="javascript:;">
        <i class="iconfont icon-wxapp"></i>
        <div class="floatbtn-wrapper">
            <div class="qrcode"><img src="https://www.muker.cc/uploads/20210611/f75e8bc38b426f1a8ae2604807729aca.jpg"></div>
            <p>微信小程序</p>
            <p>微信扫一扫体验</p>
        </div>
    </a>
    
    <a class="hover" href="../../index/cms.archives/post.html" target="_blank">
        <i class="iconfont icon-pencil"></i>
        <em>立即<br>投稿</em>
    </a>

    <div class="floatbtn-item floatbtn-share">
        <i class="iconfont icon-share"></i>
        <div class="floatbtn-wrapper" style="height:50px;top:0">
            <div class="social-share" data-initialized="true" data-mode="prepend">
                <a href="#" class="social-share-icon icon-weibo" target="_blank"></a>
                <a href="#" class="social-share-icon icon-qq" target="_blank"></a>
                <a href="#" class="social-share-icon icon-qzone" target="_blank"></a>
                <a href="#" class="social-share-icon icon-wechat"></a>
            </div>
        </div>
    </div>

        <a href="javascript:;">
        <i class="iconfont icon-qrcode"></i>
        <div class="floatbtn-wrapper">
            <div class="qrcode"><img src="https://www.muker.cc/uploads/20210611/f75e8bc38b426f1a8ae2604807729aca.jpg"></div>
            <p>微信公众账号</p>
            <p>微信扫一扫加关注</p>
        </div>
    </a>
        <a id="feedback" class="hover" href="#comments">
        <i class="iconfont icon-feedback"></i>
        <em>发表<br>评论</em>
    </a>
    
    <a id="back-to-top" class="hover" href="javascript:;">
        <i class="iconfont icon-backtotop"></i>
        <em>返回<br>顶部</em>
    </a>
    <!-- E 浮动按钮 -->
</div>


<script type="text/javascript" src="https://www.muker.cc/assets/libs/jquery/dist/jquery.min.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/libs/bootstrap/dist/js/bootstrap.min.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/libs/fastadmin-layer/dist/layer.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/libs/art-template/dist/template-native.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/addons/cms/js/jquery.autocomplete.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/addons/cms/js/swiper.min.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/addons/cms/js/share.min.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/addons/cms/js/cms.js?v=1.0.97"></script>
<script type="text/javascript" src="https://www.muker.cc/assets/addons/cms/js/common.js?v=1.0.97"></script>

<script type="text/javascript">(function(){window['__CF$cv$params']={r:'6c0998e13b657550',m:'s9JI2oW6TwRfNv3BwdTDnyQeK89poCV6cfQbseeyGFs-1640010926-0-ARJPMiSMjIzjKwk4ikqlSzzFrGnCF2woLK3zLKeJhV9wRWrWvU64yCG1or5OaUXVfRSt/wzscwBHJLSwev/bdmlwxOkW/PuoSt857tl8KDcYkv5dNigRILb7At9BJ0/cagY3MYCBMuEs2WoqrpE7grs=',s:[0x80dc0c30e4,0x11bc5e9d82],u:'/cdn-cgi/challenge-platform/h/g'}})();</script></body>
</html>
